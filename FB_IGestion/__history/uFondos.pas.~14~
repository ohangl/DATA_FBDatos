unit uFondos;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  ComCtrls, ExtCtrls, StdCtrls, uTools, Buttons, Db,  Grids, DBGrids, Spin,
  Mask, DateUtils, Wwdbigrd, Wwdbgrid, wwcheckbox, mxExport, wwdbedit,
  wwdbdatetimepicker, wwdblook, Wwdotdot, Wwdbcomb, ImgList, ppDB, ppDBPipe,
  ppComm, ppRelatv, ppProd, ppClass, ppReport, ppBands, ppPrnabl, ppStrtch,
  ppSubRpt, ppCache, ppCtrls, ppVar, ppModule, raCodMod,  RzButton,
  wwDataInspector, Menus, RzPanel, RzTabs,  RzRadGrp, Provider, DBClient,
  MDOCustomDataSet, MDOQuery, ppPageBreak, RzCmboBx, MDODatabase, RzDTP,
  RzEdit, dbisamtb;

type
  TfrmFondos = class(TForm)
    pnlHead_Caja: TRzPanel;
    lblCajaDesde: TLabel;
    edtCajaDesde: TRzDateTimeEdit;
    btnCalcularCaja: TRzBitBtn;
    lblSucursal: TLabel;
    cbSucursales: TRzComboBox;
    btnImprimir: TRzMenuButton;

    rpCaja: TppReport;
    ppDetPagoV: TppDBPipeline;
    ppDetProd: TppDBPipeline;
    hbCaja: TppHeaderBand;
    dbCaja: TppDetailBand;
    srDetPagoV: TppSubReport;
    chTotMonV: TppChildReport;
    srDetPuntos: TppSubReport;
    chTotPtos: TppChildReport;
    tbCajaTotMon: TppTitleBand;
    dbCajaTotMon: TppDetailBand;
    lblTipoPagoV: TppDBText;                         
    lblTotPgoV: TppDBText;
    lnCaja1: TppLine;
    dbCajaVS: TppDetailBand;
    lblPunto: TppDBText;
    lblTotPto: TppDBText;
    srDetProd: TppSubReport;
    chProdVend: TppChildReport;
    dbDetProd: TppDetailBand;
    lblMarca: TppDBText;
    lblCant: TppDBText;
    lblPrecioT: TppDBText;
    lblCtas: TppDBText;
    lblDescuento: TppDBText;
    tbCajaVS: TppTitleBand;
    lblTitProd: TppLabel;
    lblDetPagosV: TppLabel;
    lblDetPto: TppLabel;
    lblCantP: TppLabel;
    lblPrecioP: TppLabel;
    lblCtasP: TppLabel;
    lblDctoP: TppLabel;
    shCaja6: TppShape;
    lblTitulo: TppLabel;
    lblEmisionCaja: TppSystemVariable;
    shCaja0: TppShape;
    shCaja8: TppShape;
    lblCajaHasta: TLabel;
    edtCajaHasta: TRzDateTimeEdit;
    sbCajaTotMon: TppSummaryBand;
    ppDetTarjetas: TppDBPipeline;
    srDetalleTarjetas: TppSubReport;
    chDetOprTar: TppChildReport;
    dbCajaTM: TppDetailBand;

    lblDetCob: TppLabel;
    lblNFact: TppDBText;
    lblNCta: TppDBText;
    shCaja2: TppShape;
    smCajaVS: TppSummaryBand;
    lblTotSuc: TppDBCalc;
    shCaja3: TppShape;
    shCaja7: TppShape;

    lblOferta: TppLabel;
    lblOfer: TppDBText;

    trCaja: TMDOTransaction;

    dsqCaja: TDataSource;
    qCaja: TMDOQuery;
    qCajaIdFactura: TIntegerField;
    qCajaIdSucursal: TIntegerField;
    qCajaIdPuntoVenta: TIntegerField;
    qCajaIdCompRef: TIntegerField;
    qCajaTipoFactura: TSmallintField;
    qCajaFechaF: TDateField;
    qCajaNroFactura: TStringField;
    qCajaCliente: TIntegerField;
    qCajaEmpleado: TIntegerField;
    qCajaVendedor: TStringField;
    qCajaTipoFac: TStringField;
    qCajaEntidad: TStringField;
    qCajaDiaHora: TDateTimeField;
    qCajaTOTAL: TMDOBCDField;
    qCajaCONTADO: TMDOBCDField;
    qCajaTARJETA: TMDOBCDField;
    qCajaCTACTE: TMDOBCDField;
    qCajaNROCTAS: TIntegerField;
    qCajaCHEQUE: TMDOBCDField;
    qCajaTICKETS: TMDOBCDField;
    qCajaBONIFICACION: TMDOBCDField;
    qCajaOTROSPAGOS: TMDOBCDField;
    qCajaIdSubDep: TIntegerField;
    qCajaCOBSENAS: TMDOBCDField;
    qCajaTIPOFACLARGA: TMDOStringField;
    qCajaDetSuc: TStringField;

    dsItemsV: TDataSource;
    qItems: TMDOQuery;
    qItemsIdFactura: TIntegerField;
    qItemsIdSucursal: TIntegerField;
    qItemsIdPuntoVenta: TIntegerField;
    qItemsIdArticulo: TIntegerField;
    qItemsNroCtas: TIntegerField;
    qItemsOferta: TIntegerField;
    qItemsFechaF: TDateField;
    qItemsTalle: TIntegerField;
    qItemsSubDet: TStringField;
    qItemsDESCUENTO: TMDOBCDField;
    qItemsPRECIOTOTAL: TMDOBCDField;
    qItemsVALORLISTA: TMDOBCDField;
    qItemsMARCA: TMDOStringField;
    qItemsDETALLE: TMDOStringField;
    qItemsIdSubDep: TIntegerField;
    qItemsPRCBONIFICACION: TMDOBCDField;
    qItemsDCTOSTK: TSmallintField;
    qItemsDETSUC: TMDOStringField;
    qItemsMAXDTOCDO: TMDOBCDField;
    qItemsMAXDCTO: TMDOBCDField;
    qItemsCANTIDAD: TIntegerField;
    qItemsIDAUTORDTO: TIntegerField;
    qItemsMOSDOM: TSmallintField;
    qItemsIDSUCSALIDA: TIntegerField;
    qItemsNOMBRE: TMDOStringField;
    qItemsREMSUCSAL: TIntegerField;
    qItemsREMFACSAL: TIntegerField;
    qItemsIDAREA: TIntegerField;
    qItemsIDGRUPO: TIntegerField;
    qItemsIDSUBGRUPO: TIntegerField;
    qItemsFECHASAL: TDateField;
    qItemsDIAHORA: TDateTimeField;

    dsDetMovTar: TDataSource;
    qMovTar: TMDOQuery;
    qMovTarIdFactura: TIntegerField;
    qMovTarIdSucursal: TIntegerField;
    qMovTarIDTARJETA: TIntegerField;
    qMovTarFechaOp: TDateField;
    qMovTarCodTar: TStringField;
    qMovTarNroCuota: TSmallintField;
    qMovTarTarjeta: TStringField;
    qMovTarNroFactura: TStringField;
    qMovTarDetOper: TStringField;
    qMovTarTOTALOP: TMDOBCDField;
    qMovTarIMPCUOTA: TMDOBCDField;
    qMovTarAutorizacion: TStringField;
    qMovTarTIPOFACTURA: TSmallintField;
    qMovTarTIPOFAC: TMDOStringField;
    qMovTarIDMOV: TIntegerField;

    qSucur: TMDOQuery;
    qSucurNombreSuc: TStringField;
    qSucurIDSUCURSAL: TIntegerField;
    qSucurTOTAL: TMDOBCDField;
    qSucurCANTOP: TIntegerField;

    qMoneyV: TMDOQuery;
    qMoneyVEFECTIVO: TMDOBCDField;
    qMoneyVTARJETA: TMDOBCDField;
    qMoneyVBONIFICACION: TMDOBCDField;
    qMoneyVOTROS: TMDOBCDField;
    qMoneyVTICKETS: TMDOBCDField;
    qMoneyVCHEQUES: TMDOBCDField;
    qMoneyVSENAS: TMDOBCDField;

    dsTotPtos: TDataSource;

    dsqVendedores: TDataSource;
    qVendedores: TMDOQuery;
    qVendedoresIDEMPLEADO: TIntegerField;
    qVendedoresNOMBRE: TMDOStringField;
    qVendedoresTOTAL: TMDOBCDField;
    qVendedoresTOTALCOMISION: TMDOBCDField;
    qVendedoresCANTOP: TLargeintField;

    dsqTotTj: TDataSource;
    qTotTj: TMDOQuery;
    qTotTjIDSUCURSAL: TIntegerField;
    qTotTjTARJETA: TMDOStringField;
    qTotTjTOTTAR: TMDOBCDField;
    qTotTjCANTOP: TIntegerField;

    dsTotMonedaV: TDataSource;
    TotMonedaV: TClientDataSet;
    TotMonedaVDetalle: TStringField;
    TotMonedaVImporte: TMDOBCDField;
    TotMonedaVPrcMda: TMDOBCDField;

    qVentaS: TMDOQuery;
    qVentaSFechaF: TDateField;
    qVentaSIdSucursal: TIntegerField;
    qVentaSSucursal: TStringField;
    qVentaSIVAVTA: TMDOBCDField;
    qVentaSIMPINT: TMDOBCDField;
    qVentaSTOTAL: TMDOBCDField;
    qVentaSGTOTAL: TMDOBCDField;

    dsVentasS: TDataSource;
    VentaS: TClientDataSet;

    qTVentaS: TMDOQuery;
    qTVentaSIdSucursal: TIntegerField;
    qTVentaSSucursal: TStringField;
    qTVentaSTIVAVTA: TMDOBCDField;
    qTVentaSTIMPINT: TMDOBCDField;
    qTVentaSTTOTAL: TMDOBCDField;

    dsCobros: TDataSource;
    qCobros: TMDOQuery;
    qCobrosIDFACTURA: TIntegerField;
    qCobrosIDSUCURSAL: TIntegerField;
    qCobrosIDPUNTOVENTA: TIntegerField;
    qCobrosIDCOMPREF: TIntegerField;
    qCobrosTIPOFACTURA: TSmallintField;
    qCobrosDIAHORA: TDateTimeField;
    qCobrosFECHAF: TDateField;
    qCobrosNROFACTURA: TMDOStringField;
    qCobrosCLIENTE: TIntegerField;
    qCobrosTOTAL: TMDOBCDField;
    qCobrosCONTADO: TMDOBCDField;
    qCobrosTARJETA: TMDOBCDField;
    qCobrosCTACTE: TMDOBCDField;
    qCobrosIDSUBDEP: TIntegerField;
    qCobrosNROCTAS: TIntegerField;
    qCobrosCHEQUE: TMDOBCDField;
    qCobrosTICKETS: TMDOBCDField;
    qCobrosBONIFICACION: TMDOBCDField;
    qCobrosOTROSPAGOS: TMDOBCDField;
    qCobrosEMPLEADO: TIntegerField;
    qCobrosENTIDAD: TMDOStringField;
    qCobrosVENDEDOR: TMDOStringField;
    qCobrosTIPOFAC: TMDOStringField;
    qCobrosDETSUC: TMDOStringField;
    qCobrosCOBSENAS: TMDOBCDField;
    qCobrosTIPOFACLARGA: TMDOStringField;

    dsResumenF: TDataSource;
    ResumenF: TClientDataSet;
    ResumenFDetalleMov: TStringField;
    ResumenFDebe: TCurrencyField;
    ResumenFHaber: TCurrencyField;
    ResumenFSaldo: TCurrencyField;

    TotTar: TClientDataSet;
    TotTarTarjeta: TStringField;
    TotTarTotTar: TCurrencyField;
    TotTarPrcTar: TFloatField;
    TotTarCantOP: TSmallintField;

    dsAreas: TDataSource;
    qAreas: TMDOQuery;
    qAreasAREA: TMDOStringField;
    qAreasGRUPO: TMDOStringField;
    qAreasTOTAL: TMDOBCDField;
    qAreasDETSUC: TMDOStringField;

    cdsAreas: TClientDataSet;
    dspAreas: TDataSetProvider;
    cdsAreasAREA: TStringField;
    cdsAreasGRUPO: TStringField;
    cdsAreasTOTAL: TBCDField;
    cdsAreasPrcTot: TMDOBCDField;
    cdsAreasDETSUC: TStringField;

    TotPtos: TClientDataSet;
    TotPtosIdSucursal: TIntegerField;
    TotPtosNombreSuc: TStringField;
    TotPtosTipoOP: TSmallintField;
    TotPtosTotal: TCurrencyField;

    dsTotMonedaC: TDataSource;
    TotMonedaC: TClientDataSet;
    TotMonedaCDetalle: TStringField;
    TotMonedaCImporte: TCurrencyField;
    TotMonedaCPrcMda: TFloatField;

    dsTotalesMoneda: TDataSource;
    TotalesMoneda: TClientDataSet;
    TotalesMonedaDetalle: TStringField;
    TotalesMonedaImporte: TCurrencyField;
    TotalesMonedaPrcMda: TFloatField;

    qMoneyC: TMDOQuery;
    qMoneyCEFECTIVO: TMDOBCDField;
    qMoneyCTARJETA: TMDOBCDField;
    qMoneyCBONIFICACION: TMDOBCDField;
    qMoneyCOTROS: TMDOBCDField;
    qMoneyCTICKETS: TMDOBCDField;
    qMoneyCCHEQUES: TMDOBCDField;
    qMoneyCSENAS: TMDOBCDField;

    dsqSenas: TDataSource;
    qSenas: TMDOQuery;
    qSenasIDFACTURA: TIntegerField;
    qSenasIDSUCURSAL: TIntegerField;
    qSenasIDPUNTOVENTA: TIntegerField;
    qSenasCLIENTE: TIntegerField;
    qSenasFECHAF: TDateField;
    qSenasTOTAL: TMDOBCDField;
    qSenasIMPRESA: TSmallintField;
    qSenasNOMBRE: TMDOStringField;
    qSenasNROFACTURAS: TMDOStringField;
    qSenasTIPOFACS: TMDOStringField;
    qSenasIDCOMPREF: TIntegerField;

    qTotSen: TMDOQuery;
    qTotSenTOTSS: TMDOBCDField;

    qTotSenIng: TMDOQuery;
    qTotSenIngTOTSENING: TMDOBCDField;

    dsqSen_Ing: TDataSource;
    qSen_Ing: TMDOQuery;
    qSen_IngIDFACTURA: TIntegerField;
    qSen_IngIDSUCURSAL: TIntegerField;
    qSen_IngIDPUNTOVENTA: TIntegerField;
    qSen_IngFECHAF: TDateField;
    qSen_IngCLIENTE: TIntegerField;
    qSen_IngTOTAL: TMDOBCDField;
    qSen_IngNOMBRE: TMDOStringField;
    qSen_IngTIPOFACS: TMDOStringField;
    qSen_IngTIPOFACE: TMDOStringField;
    qSen_IngNROFACTURAE: TMDOStringField;
    qSen_IngCOBSENAS: TMDOBCDField;
    qSen_IngTOTPAG: TMDOBCDField;
    qSen_IngOTROSPAGOS: TMDOBCDField;
    qSen_IngNROFACTURAS: TMDOStringField;

    dsqOtCmp: TDataSource;
    qOtCmp: TMDOQuery;
    qOtCmpIDFACTURA: TIntegerField;
    qOtCmpIDSUCURSAL: TIntegerField;
    qOtCmpIDPUNTOVENTA: TIntegerField;
    qOtCmpCLIENTE: TIntegerField;
    qOtCmpNROFACTURA: TMDOStringField;
    qOtCmpFECHAF: TDateField;
    qOtCmpTOTAL: TMDOBCDField;
    qOtCmpTIPOFACTURA: TSmallintField;
    qOtCmpNOMBRE: TMDOStringField;
    qOtCmpTIPOFAC: TMDOStringField;
    qOtCmpDETSUC: TMDOStringField;

    dsInfVtas: TDataSource;
    qArtVend: TMDOQuery;
    qArtVendIDARTICULO: TIntegerField;
    qArtVendIDSUCURSAL: TIntegerField;
    qArtVendFECHAF: TDateField;
    qArtVendOFERTA: TIntegerField;
    qArtVendIDGRUPO: TIntegerField;
    qArtVendIDSUBGRUPO: TIntegerField;
    qArtVendDETART: TMDOStringField;
    qArtVendDETGRP: TMDOStringField;
    qArtVendDETSGR: TMDOStringField;
    qArtVendDETSUC: TMDOStringField;
    qArtVendIDFACTURA: TIntegerField;
    qArtVendIDPUNTOVENTA: TIntegerField;
    qArtVendPRECIOTOTAL: TMDOBCDField;
    qArtVendIDAREA: TIntegerField;
    qArtVendCANTIDAD: TIntegerField;

    qLiqTM: TMDOQuery;
    qLiqTMIDFACTURA: TIntegerField;
    qLiqTMIDSUCURSAL: TIntegerField;
    qLiqTMIDPUNTOVENTA: TIntegerField;
    qLiqTMIDCOMPREF: TIntegerField;
    qLiqTMTIPOFACTURA: TSmallintField;
    qLiqTMDIAHORA: TDateTimeField;
    qLiqTMFECHAF: TDateField;
    qLiqTMNROFACTURA: TMDOStringField;
    qLiqTMCLIENTE: TIntegerField;
    qLiqTMTOTAL: TMDOBCDField;
    qLiqTMNROCTAS: TIntegerField;
    qLiqTMCONTADO: TMDOBCDField;
    qLiqTMTARJETA: TMDOBCDField;
    qLiqTMCTACTE: TMDOBCDField;
    qLiqTMCHEQUE: TMDOBCDField;
    qLiqTMTICKETS: TMDOBCDField;
    qLiqTMBONIFICACION: TMDOBCDField;
    qLiqTMOTROSPAGOS: TMDOBCDField;
    qLiqTMCOBSENAS: TMDOBCDField;
    qLiqTMEMPLEADO: TIntegerField;
    qLiqTMIDSUBDEP: TIntegerField;
    qLiqTMTARJETA1: TMDOStringField;
    qLiqTMIDTARJETA: TIntegerField;
    qLiqTMDETSUC: TMDOStringField;
    qLiqTMENTIDAD: TMDOStringField;
    qLiqTMVENDEDOR: TMDOStringField;
    qLiqTMTIPOFAC: TMDOStringField;
    qLiqTMTIPOFACLARGA: TMDOStringField;

    ppDetComp: TppDBPipeline;
    srDetalleCompV: TppSubReport;
    chDetOprVta: TppChildReport;
    tbDetComp: TppTitleBand;
    dbDetComp: TppDetailBand;
    sbCajaOV: TppSummaryBand;
    lblTitVentas: TppLabel;
    lblTFac: TppDBText;
    lblNFac: TppDBText;
    lblFCli: TppDBText;
    lblFTot: TppDBText;
    lblFSuc: TppDBText;
    lblTotVta: TppDBCalc;
    shCaja13: TppShape;
    btnExportar: TRzMenuButton;
    pmExpFondos: TPopupMenu;
    opSucursales: TMenuItem;
    opProductos: TMenuItem;
    opComprobantes: TMenuItem;
    opVendedores: TMenuItem;
    opTarjetas: TMenuItem;
    opTotalesV: TMenuItem;

    opGrupos: TMenuItem;
    ppAreas: TppDBPipeline;
    srDetGrupos: TppSubReport;
    chDetGrupos: TppChildReport;
    dbAreas: TppDetailBand;
    lblTitAreas: TppLabel;
    shVtaPorArea1: TppShape;
    lblFTarj: TppDBText;

    pcFondos: TRzPageControl;
    tsTotales: TRzTabSheet;
    tsFacturacion: TRzTabSheet;
    tsGrupos: TRzTabSheet;
    tsInfSucursales: TRzTabSheet;
    gbTipoPagos: TRzGroupBox;
    gbSucursales: TRzGroupBox;
    gTotalesPtos: TwwDBGrid;
    ppTotTarj: TppDBPipeline;
    srTotTarj: TppSubReport;
    chTotTar: TppChildReport;
    tbTarMut: TppTitleBand;
    shCaja5: TppShape;
    lblTitTarj: TppLabel;
    dbTarMut: TppDetailBand;
    lblDetTarj: TppDBText;
    lblMtoTarj: TppDBText;
    sbTarMut: TppSummaryBand;
    shCaja4: TppShape;
    lblTotalTj: TppLabel;
    lblTotTarj: TppDBCalc;
    shCaja12: TppShape;
    pnlTopTS: TRzPanel;
    lblDesdeTS: TLabel;
    lblHastaTS: TLabel;
    btnCalcularTS: TRzBitBtn;
    btnImprimirTS: TRzBitBtn;
    btnExportarTS: TRzBitBtn;
    edtDesdeTS: TRzDateTimeEdit;
    edtHastaTS: TRzDateTimeEdit;
    gVentaS: TwwDBGrid;

    ppVentas: TppDBPipeline;
    rpVentasS: TppReport;
    hbVtaS: TppHeaderBand;
    shTit: TppShape;
    lblEmisionVtaS: TppSystemVariable;
    lblTituloTS: TppLabel;
    lblFecha: TppLabel;
    lblTDia: TppLabel;
    lblDSuc3: TppLabel;
    lblDSuc4: TppLabel;
    lblDSuc5: TppLabel;
    lblDSuc6: TppLabel;
    lblDSuc7: TppLabel;
    lblDSuc9: TppLabel;
    dbVtaS: TppDetailBand;
    shLin: TppShape;
    lblDia: TppDBText;
    lblSuc3: TppDBText;
    lblSuc4: TppDBText;
    lblSuc5: TppDBText;
    lblSuc6: TppDBText;
    lblSuc7: TppDBText;
    lblSuc9: TppDBText;
    lblTxDia: TppDBText;
    ppLine3: TppLine;
    ppLine6: TppLine;
    ppLine7: TppLine;
    ppLine8: TppLine;
    ppLine9: TppLine;
    ppLine10: TppLine;
    sbVtaS: TppSummaryBand;
    shPie: TppShape;
    lblTotDia: TppDBCalc;
    lblTSuc3: TppDBCalc;
    lblTSuc4: TppDBCalc;
    lblTSuc5: TppDBCalc;
    lblTSuc6: TppDBCalc;
    lblTSuc7: TppDBCalc;
    lblTSuc9: TppDBCalc;
    lblTotales: TppLabel;
    btnRendicion: TRzBitBtn;
    ppLine11: TppLine;
    ppLine13: TppLine;
    ppLine14: TppLine;
    ppLine15: TppLine;
    ppLine16: TppLine;
    ppLine17: TppLine;
    btnSucursales: TRzBitBtn;
    pdSucur: TPrintDialog;
    lblDetArt: TppDBText;
    gbTotalesC: TRzGroupBox;
    gCaja: TwwDBGrid;
    ppDetCobros: TppDBPipeline;
    ppGroup1: TppGroup;
    hbgTFacV: TppGroupHeaderBand;
    fbCajaOV: TppGroupFooterBand;
    lblTotTipo: TppDBCalc;
    lblCantComp: TppDBCalc;
    lblBonifProd: TppDBText;
    lblPrcTar: TppDBText;
    ppDetPuntos: TppDBPipeline;
    lblTipoOP: TppDBText;
    lblTotDetPagoV: TppDBCalc;
    lblContadoF: TppDBText;
    lblTicketsF: TppDBText;
    lblTarjMutF: TppDBText;
    lblChequesF: TppDBText;
    lblContF: TppLabel;
    lblTktF: TppLabel;
    lblCardMF: TppLabel;
    lblChqF: TppLabel;
    lblDctoF: TppLabel;
    lblDescuentoF: TppDBText;
    shpDetComp: TppShape;
    lblSenF: TppLabel;
    lblSenasF: TppDBText;
    gTotMonedasC: TwwDBGrid;
    opTotalesC: TMenuItem;
    srDetPagoC: TppSubReport;
    chTotMonCob: TppChildReport;
    rbCajaMonCob: TppTitleBand;
    shCaja9: TppShape;
    lblTitTipoPagosC: TppLabel;
    dbCajaMonCob: TppDetailBand;
    lblDetPagoC: TppDBText;
    lblTotPagoC: TppDBText;
    lnCaja2: TppLine;
    sbCajaMonCob: TppSummaryBand;
    lblTotDetPagoC: TppDBCalc;
    ppDetPagoC: TppDBPipeline;
    lblSaFF: TppLabel;
    lblSaFNC: TppDBText;
    lblIdEntidad: TppDBText;
    lblFFac: TppDBText;
    ppLabel1: TppLabel;
    tsCobranza: TRzTabSheet;
    gCobros: TwwDBGrid;
    gbTotalesV: TRzGroupBox;
    gTotMonedasV: TwwDBGrid;
    tsTarjetas: TRzTabSheet;
    gbTarjetas: TRzGroupBox;
    gDetTarjetas: TwwDBGrid;
    srDetalleCompC: TppSubReport;
    chDetOprCob: TppChildReport;
    tbOperCob: TppTitleBand;
    shTitCob: TppShape;
    lblOperRC: TppLabel;
    dbOperCob: TppDetailBand;
    shpDetCob: TppShape;
    lblNroRecC: TppDBText;
    lblNomCliC: TppDBText;
    lblTotRecC: TppDBText;
    lblSucC: TppDBText;
    lblEftC: TppDBText;
    lblTktC: TppDBText;
    lblTarC: TppDBText;
    lblChqC: TppDBText;
    lblDetEftC: TppLabel;
    lblDetTktC: TppLabel;
    lblDetTMC: TppLabel;
    lblDetChqC: TppLabel;
    lblDetDtoC: TppLabel;
    lblDctoC: TppDBText;
    lblDetSenaC: TppLabel;
    lblSenC: TppDBText;
    lblDetSucC: TppLabel;
    lblNroCliC: TppDBText;
    lblTotalR: TppLabel;
    sbOperCob: TppSummaryBand;
    shTotCob: TppShape;
    lblTotalCob: TppDBCalc;
    ppGroup2: TppGroup;
    hbOperCob: TppGroupHeaderBand;
    lblTipoFacC: TppDBText;
    lblFechaC: TppDBText;
    fbOperCob: TppGroupFooterBand;
    lblTotCompC: TppDBCalc;
    lblCantCompC: TppDBCalc;
    sbCaja: TppSummaryBand;
    lblPagina: TppSystemVariable;
    lblDSucV: TppLabel;
    lblClienteV: TppLabel;
    lblCliRec: TppLabel;
    chbDetProd: TppColumnHeaderBand;
    cfbProdVend: TppColumnFooterBand;
    chbAreas16: TppColumnHeaderBand;
    ppColumnFooterBand3: TppColumnFooterBand;
    fbCaja: TppFooterBand;
    lblTotalCobraza: TppLabel;
    lblTotalVta: TppLabel;
    shCaja1: TppShape;
    lblCantOPV: TppDBText;
    lblPrcMdaV: TppDBText;
    lblPrcMdaC: TppDBText;
    btnSalir: TRzBitBtn;

    srSenSaF: TppSubReport;
    ppChildReport1: TppChildReport;
    ppSenSaF: TppDBPipeline;
    tbCajaSS: TppTitleBand;
    dbCajaSS: TppDetailBand;
    lblTitSen: TppLabel;
    lblNomSen: TppDBText;
    shCaja10: TppShape;
    lblFecSen: TppDBText;
    lblTotSen: TppDBText;
    lblTotPend: TppDBCalc;
    lblTotPendiente: TppLabel;
    shCaja11: TppShape;
    lblTotEftPV: TppDBCalc;
    lblTotTktPV: TppDBCalc;
    lblTotChqPV: TppDBCalc;
    lblTotSenPV: TppDBCalc;
    lblTotSafPV: TppDBCalc;
    lblTotBonPV: TppDBCalc;
    lblTotTarPV: TppDBCalc;
    lblTotEftTV: TppDBCalc;
    lblTotTktTV: TppDBCalc;
    lblTotChqTV: TppDBCalc;
    lblTotSenTV: TppDBCalc;
    lblTotSafTV: TppDBCalc;
    lblTotBonTV: TppDBCalc;
    lblTotTarTV: TppDBCalc;
    lblTotEftPC: TppDBCalc;
    lblTotTktPC: TppDBCalc;
    lblTotChqPC: TppDBCalc;
    lblTotSenPC: TppDBCalc;
    lblTotDebPC: TppDBCalc;
    lblTotTarPC: TppDBCalc;
    lblTotEftTC: TppDBCalc;
    lblTotTktTC: TppDBCalc;
    lblTotChqTC: TppDBCalc;
    lblTotSenTC: TppDBCalc;
    lblTotDebTC: TppDBCalc;
    lblTotTarTC: TppDBCalc;
    lblVtaAreas: TppDBText;
    lblTotVtaArea: TppDBText;
    lblPrcVtaArea: TppDBText;
    rpVendedores: TppReport;
    hbComByArea: TppHeaderBand;
    dbComByArea: TppDetailBand;
    lblTitVtaVdor1: TppLabel;
    lblTitVtaVdor2: TppLabel;
    ppSummaryBand3: TppSummaryBand;
    dbpVendedores: TppDBPipeline;
    dbpTotVend: TppDBPipeline;
    gbTotalesMonedas: TRzGroupBox;
    gTotalesMonedas: TwwDBGrid;
    ppDetOtCmp: TppDBPipeline;
    srDetOtCmp: TppSubReport;
    ppChildReport3: TppChildReport;
    dbDetOtrCmp: TppDetailBand;
    lblTitOtCmp: TppLabel;
    ppColumnHeaderBand1: TppColumnHeaderBand;
    ppColumnFooterBand2: TppColumnFooterBand;
    lblNombreOC: TppDBText;
    lblTFacOC: TppDBText;
    lblNroCOC: TppDBText;
    lblFecOC: TppDBText;
    lblMtoOC: TppDBText;
    shCaja16: TppShape;
    OtrosComprobantes: TMenuItem;
    tsResumenFondos: TRzTabSheet;

    gResumenF: TwwDBGrid;
    lblTFacDT: TppDBText;
    ppGroup4: TppGroup;
    ghbTotXDia: TppGroupHeaderBand;
    gfbTotXDia: TppGroupFooterBand;
    lblTotXDia: TppDBCalc;
    lblTotEftXDia: TppDBCalc;
    lblTotTktXDia: TppDBCalc;
    lblTotChqXDia: TppDBCalc;
    lblTotSenXDia: TppDBCalc;
    lblTotSaFXDia: TppDBCalc;
    lblTotBonXDia: TppDBCalc;
    lblTotTarXDia: TppDBCalc;
    lblTotFecha: TppDBText;
    shCaja17: TppLine;
    ppGroup5: TppGroup;
    hfbTotCobDia: TppGroupHeaderBand;
    gfbTotCobDia: TppGroupFooterBand;
    lblTotCobDia: TppDBCalc;
    lblTotEftDia: TppDBCalc;
    lblTotTktDia: TppDBCalc;
    lblTotChqDia: TppDBCalc;
    lblTotSenDia: TppDBCalc;
    lblTotOPgDia: TppDBCalc;
    lblTotTarDia: TppDBCalc;
    ppDBText1: TppDBText;
    shCaja18: TppLine;
    shCaja20: TppShape;
    shCaja19: TppShape;
    ppDetMon: TppDBPipeline;
    srTotMon: TppSubReport;
    ppChildReport4: TppChildReport;
    tbCajaTotMonT: TppTitleBand;
    dbCajaTotMonT: TppDetailBand;
    sbCajaTotMonT: TppSummaryBand;
    shCaja21: TppShape;
    lblTitCajaTotMonT: TppLabel;
    lblDetCajaTotMonT: TppDBText;
    lblMontoCajaTotMonT: TppDBText;
    lblPrcMdaCajaTotMonT: TppDBText;
    lblTotalCajaTotMonT: TppDBCalc;
    tsOtrosComp: TRzTabSheet;
    gOtrosComp: TwwDBGrid;
    pmOpcionesFondos: TPopupMenu;
    TotPtosCantOp: TIntegerField;
    pcProductosVendidos: TRzPageControl;
    tsProdVend: TRzTabSheet;
    tsVentaByAreas: TRzTabSheet;
    gAreas: TwwDBGrid;
    gItems: TwwDBGrid;
    ppColumnHeaderBand2: TppColumnHeaderBand;
    ppColumnFooterBand4: TppColumnFooterBand;
    shCaja22: TppShape;
    shCaja23: TppShape;
    shCaja24: TppShape;
    lblNroSen: TppDBText;
    opCobranza: TMenuItem;
    lblFEmp: TppDBText;
    lblDEmpV: TppLabel;
    gbTotalesSenas: TRzGroupBox;
    gbSenas: TRzGroupBox;
    gSenas: TwwDBGrid;
    gSen_Ing: TwwDBGrid;
    SenasSaFenStock: TMenuItem;
    SenasOcupadas: TMenuItem;
    ppSenasIng: TppDBPipeline;
    srSenasIng: TppSubReport;
    ppChildReport5: TppChildReport;
    shSenIng1: TppShape;
    lblTitSenIng: TppLabel;
    dbSenIng: TppDetailBand;
    lblSITNroCom: TppDBText;
    lblSINroSal: TppDBText;
    lblSenIngTotal: TppDBText;
    lblSenIngTotalIngresado: TppDBCalc;
    lblTotSenIng: TppLabel;
    lblSenIngNroRec: TppLabel;
    lblSenIngComp: TppLabel;
    lblSenIngMto: TppLabel;

    sbFondos: TRzStatusBar;
    lblObsDto: TppDBText;
    lnProd1: TppLine;
    lnProdVend1: TppLine;
    shpProdVend2: TppShape;
    rpInfPrdVta: TppReport;
    ppHeaderBandIV: TppHeaderBand;
    lblPVTitulo1: TppLabel;
    lblPVTitulo2: TppLabel;
    lblPVEmision: TppSystemVariable;
    lblPVNroPag: TppSystemVariable;
    dbPVProd: TppDetailBand;
    lblPVCodigo: TppDBText;
    lblPVDetArt: TppDBText;
    lblPVCantidad: TppDBText;
    lblPVTotVen: TppDBText;
    lblPVSucDet: TppDBText;
    lblPVOferta: TppDBText;
    ppFooterBand2: TppFooterBand;
    sbPVPie: TppSummaryBand;
    ppShpPV3: TppShape;
    ppGroup6: TppGroup;
    ghbPVGrupos: TppGroupHeaderBand;
    ppShpPV1: TppShape;
    lblGrupo: TppDBText;
    lblPVTotGrp: TppDBCalc;
    lblGrp: TppLabel;
    gfbPVGupos: TppGroupFooterBand;
    ppGroup7: TppGroup;
    ghbPVSubGrupos: TppGroupHeaderBand;
    ppShpPV2: TppShape;
    lblSubGrupo: TppDBText;
    lblPVTotSGrp: TppDBCalc;
    lblSubGrp: TppLabel;
    gfbPVSubGR: TppGroupFooterBand;
    ppArtVend: TppDBPipeline;
    lblTotPrdVen: TppDBCalc;
    ppShpPV4: TppShape;
    ppColumnHeaderBand3: TppColumnHeaderBand;
    ppColumnFooterBand1: TppColumnFooterBand;
    lblSITCom: TppDBText;
    lblSIFechaSen: TppDBText;
    lblSIFecOrg: TppLabel;
    lblNroComApli: TppLabel;
    lblSIFecSal: TppDBText;
    lblTotByAreas: TppDBCalc;
    lblTotPrdVendidos: TppDBCalc;
    lblSenEmiComp: TppLabel;
    shSenIng2: TppShape;
    ppColumnHeaderBand4: TppColumnHeaderBand;
    ppColumnFooterBand5: TppColumnFooterBand;
    shpProdVend3: TppShape;
    lblTotVenPrd: TppLabel;
    shVtaPorArea2: TppShape;
    lblSucAreas: TppDBText;
    lblSITCliente: TppDBText;
    lblSITotSal: TppDBText;
    lblSICliente: TppLabel;
    lblSITotIng: TppLabel;
    lnSenSaf: TppLine;
    ppShape1: TppShape;
    shpProdVend4: TppShape;
    lblProductosVend: TppLabel;
    shSenIng3: TppShape;
    lblTarTotalOP: TppDBText;
    lblTarTotOper: TppDBCalc;
    ppLine1: TppLine;
    pmImpCaja: TPopupMenu;
    TotalesCaja: TMenuItem;
    TodoelInforme: TMenuItem;
    OperacionesporVendedorCaja: TMenuItem;
    ProductosVendidosCaja: TMenuItem;
    gbTotalesTajetas: TRzGroupBox;
    gTotTarjetas: TwwDBGrid;
    TotTarDetSuc: TStringField;
    lblCantTar: TppDBText;
    lblSucTar: TppDBText;
    lnDetTar: TppLine;
    ppGroup8: TppGroup;
    ppGroupHeaderBand1: TppGroupHeaderBand;
    ppGroupFooterBand1: TppGroupFooterBand;
    lblDetEntTar: TppDBText;
    lblDetCodTar: TppDBText;
    ppDBText2: TppDBText;
    lblTotByTar: TppDBCalc;
    lnDetTar1: TppLine;
    lnDetTar2: TppLine;
    lblCantTarj: TppDBCalc;
    gTotalesVendedores: TwwDBGrid;
    lblNroVend: TppDBText;
    lblNomVend: TppDBText;
    lblCOPByVend: TppDBText;
    lblTotByVend: TppDBText;
    shComByArea3: TppShape;
    shComByArea4: TppShape;
    lblEmisionComByArea: TppSystemVariable;

    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btnSalirClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnCalcularCajaClick(Sender: TObject);
    procedure gCajaDblClick(Sender: TObject);
    procedure gCajaCalcCellColors(Sender: TObject; Field: TField;
      State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
    procedure gItemsDblClick(Sender: TObject);
    procedure gTotMonedasVUpdateFooter(Sender: TObject);
    procedure gDetTarjetasDblClick(Sender: TObject);
    procedure lblOferGetText(Sender: TObject; var Text: String);
    procedure qItemsOfertaGetText(Sender: TField; var Text: String; DisplayText: Boolean);
    procedure opSucursalesClick(Sender: TObject);
    procedure opProductosClick(Sender: TObject);
    procedure opComprobantesClick(Sender: TObject);
    procedure opVendedoresClick(Sender: TObject);
    procedure opTarjetasClick(Sender: TObject);
    procedure opTotalesVClick(Sender: TObject);
    procedure opGruposClick(Sender: TObject);
    procedure gSen_IngUpdateFooter(Sender: TObject);
    procedure gAreasUpdateFooter(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure qMovTarCalcFields(DataSet: TDataSet);
    procedure btnImprimirTSClick(Sender: TObject);
    procedure btnExportarTSClick(Sender: TObject);
    procedure btnCalcularTSClick(Sender: TObject);
    procedure gVentaSUpdateFooter(Sender: TObject);
    procedure btnRendicionClick(Sender: TObject);
    procedure btnSucursalesClick(Sender: TObject);
    procedure gItemsCalcCellColors(Sender: TObject; Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
    procedure gCobrosUpdateFooter(Sender: TObject);
    procedure gCobrosCalcCellColors(Sender: TObject; Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
    procedure gTotalesPtosUpdateFooter(Sender: TObject);
    procedure TotPtosTipoOPGetText(Sender: TField; var Text: String; DisplayText: Boolean);
    procedure lblTipoOPGetText(Sender: TObject; var Text: String);
    procedure gCobrosDblClick(Sender: TObject);
    procedure gTotMonedasCUpdateFooter(Sender: TObject);
    procedure opTotalesCClick(Sender: TObject);
    procedure gSenasUpdateFooter(Sender: TObject);
    procedure gSenasDblClick(Sender: TObject);
    procedure gTotalesMonedasUpdateFooter(Sender: TObject);
    procedure gOtrosCompDblClick(Sender: TObject);
    procedure OtrosComprobantesClick(Sender: TObject);
    procedure opCobranzaClick(Sender: TObject);
    procedure gCajaUpdateFooter(Sender: TObject);
    procedure SenasSaFenStockClick(Sender: TObject);
    procedure SenasOcupadasClick(Sender: TObject);
    procedure gTotTarjetasUpdateFooter(Sender: TObject);
    procedure ProductosVendidosCajaClick(Sender: TObject);
    procedure qArtVendOFERTAGetText(Sender: TField; var Text: string; DisplayText: Boolean);
    procedure lblPVOfertaGetText(Sender: TObject; var Text: string);
    procedure gItemsUpdateFooter(Sender: TObject);
    procedure gItemsTitleButtonClick(Sender: TObject; AFieldName: string);
    procedure TodoelInformeClick(Sender: TObject);
    procedure TotalesCajaClick(Sender: TObject);
    procedure OperacionesporVendedorCajaClick(Sender: TObject);
  private
    { Private declarations }
    TotalCaja, TotMoneyV, TotMoneyC, TotalTarj,
    TotalArea, TotalVS, TotXDia, TotalCob, TotalSen, TotSenIng: Currency;
    SVenta, SMovTj, STotTj, SSucur, SucCob,
    SMoneyV, SOtCmp, SMoneyC, SEmple,
    SAreas, SCobro, SSenSaF, STotSen, SSenIng,
    STotIng, SLiqTM, SucLiq: String;

    IdSucur, IdSucES: Integer;

    procedure ArmarTabla;
    procedure LlenarTabla;
    procedure TotalesTabla;
    procedure Calcular_VentaS;

    procedure Calc_Caja;
    procedure Calc_Productos;
    procedure Calc_Facturacion;
    procedure Calcular_Caja;
    procedure CajaEnLpt;
  public
    { Public declarations }
  end;

var
  frmFondos: TfrmFondos;

implementation

uses udmGestion, uFiscal, uViewFacV, uViewFacC, udmSaveFile, uClaveMod,
     uRendicion, uViewMT, uGestSucursales;

{$R *.DFM}

Const
   Venta = 'Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.IdCompRef, '+
           '       F.TipoFactura, F.DiaHora, F.CantArtic, F.FechaF, F.NroFactura, '+
           '       F.Cliente, F.Total, F.NroCtas, F.Contado, F.Tarjeta, F.CtaCte, '+
           '       F.Cheque, F.Tickets, F.Bonificacion, F.OtrosPagos, F.CobSenas, '+
           '       F.Empleado, F.IdSubDep, S.DetSuc, C.Nombre as Entidad, '+
           '       E.Nombre as Vendedor, T.DescCorta as TipoFac, '+
           '       T.Descripcion as TipoFacLarga '+
           'From FacVen F '+
           'Left outer Join Clientes C '+
           '  on C.IdCliente = F.Cliente And C.IdSucursal = F.IdSucursal '+
           'Left outer Join Empleados E '+
           '  on E.IdEmpleado = F.Empleado '+
           'Left outer Join TiposComp T '+
           '  on T.IdComprobante = F.TipoFactura '+
           'Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde and :Hasta) And '+
           '      (F.TipoFactura in (1,2,3,5,6,7,8,43,44,45,47,60,90)) <SUCUR> '+
           'Order By F.IdSucursal, F.FechaF, F.NroFactura, F.DiaHora ';

   Cobro = 'Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.IdCompRef, '+
           '       F.TipoFactura, F.DiaHora, F.CantArtic, F.FechaF, F.NroFactura, '+
           '       F.Cliente, F.Total, F.NroCtas, F.Contado, F.Tarjeta, F.CtaCte, '+
           '       F.Cheque, F.Tickets, F.Bonificacion, F.OtrosPagos, F.CobSenas, '+
           '       F.Empleado, F.IdSubDep, S.DetSuc, C.Nombre as Entidad, K.Tarjeta, '+
           '       K.IdTarjeta, E.Nombre as Vendedor, T.DescCorta as TipoFac, '+
           '       T.Descripcion as TipoFacLarga '+
           'From FacVen F '+
           'Left outer Join Clientes C '+
           '  on C.IdCliente = F.Cliente And C.IdSucursal = F.IdSucursal '+
           'Left outer Join Empleados E '+
           '  on E.IdEmpleado = F.Empleado '+
           'Left outer Join TiposComp T '+
           '  on T.IdComprobante = F.TipoFactura '+
           'Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Left outer Join Tarjetas K '+
           '  on K.IdTarjeta = F.IdCompRef '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde and :Hasta) And '+
           '      (F.TipoFactura in (21,22,42,100)) <SUCUR> '+
           'Order By F.IdSucursal, F.FechaF, F.NroFactura, F.DiaHora ';

   Liqui = 'Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.IdCompRef, '+
           '       F.TipoFactura, F.DiaHora, F.CantArtic, F.FechaF, F.NroFactura, '+
           '       F.Cliente, F.Total, F.NroCtas, F.Empleado, F.IdSubDep, S.DetSuc, '+
           '       C.Nombre as Entidad, K.Tarjeta, K.IdTarjeta, E.Nombre as Vendedor, '+
           '       T.DescCorta as TipoFac, T.Descripcion as TipoFacLarga '+
           'From FacVen F '+
           'Left outer Join Clientes C '+
           '  on C.IdCliente = F.Cliente And C.IdSucursal = F.IdSucursal '+
           'Left outer Join Empleados E '+
           '  on E.IdEmpleado = F.Empleado '+
           'Left outer Join TiposComp T '+
           '  on T.IdComprobante = F.TipoFactura '+
           'Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Left outer Join Tarjetas K '+
           '  on K.IdTarjeta = F.IdCompRef '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde and :Hasta) And '+
           '      (F.TipoFactura = 22) <SUCUR> '+
           'Order By F.IdSucursal, F.FechaF, F.NroFactura, F.DiaHora ';

   MovTj = 'Select IdMov, IdFactura, IdSucursal, FechaOp, TotalOp, '+
           '       CodTar, NroCuota, Autorizacion, ImpCuota, IdTarjeta, '+
           '       Tarjeta, TipoFactura, NroFactura, TipoFac '+
           'From MOVTAR_TOTALES(:DESDE, :HASTA) <SUCUR> '+
           'Order By Tarjeta, FechaOp ';

   TotTj = 'Select IDSUCURSAL, TARJETA, '+
           '       Sum(TOTALOP) as TOTTAR, '+
           '       Count(IDMOV) as CantOP '+
           'From MOVTAR_TOTALES(:DESDE, :HASTA) <SUCUR> '+
           'Group By IDSUCURSAL, TARJETA '+
           'Order By IDSUCURSAL, TARJETA ';

   Emple = 'Select IdEmpleado, Nombre, '+
           '       Sum(TotalV) as Total, '+
           '       Sum(TotalC) as TotalComision, '+
           '       Sum(CantOP) as CantOp '+
           'From PRODUCTOS_COMISIONES(:Desde, :Hasta, :IdSuc) '+
           'Group By IdEmpleado, Nombre '+
           'Order By 3 desc ';

   MoneyV= 'Select Sum(F.Contado) as Efectivo, Sum(F.Tarjeta) as Tarjeta, '+
           '       Sum(F.Bonificacion) as Bonificacion, Sum(F.OtrosPagos) as Otros, '+
           '       Sum(F.Tickets) as Tickets, Sum(F.Cheque) as Cheques, '+
           '       Sum(F.CobSenas) as Senas '+
           'From FacVen F '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde And :Hasta) And '+
           '      (F.TipoFactura in (1,2,3,5,6,7,8,43,44,45,47,60,90)) <SUCUR> ';

   MoneyC= 'Select Sum(F.Contado) as Efectivo, Sum(F.Tarjeta) as Tarjeta, '+
           '       Sum(F.Bonificacion) as Bonificacion, Sum(F.OtrosPagos) as Otros, '+
           '       Sum(F.Tickets) as Tickets, Sum(F.Cheque) as Cheques, '+
           '       Sum(F.CobSenas) as Senas '+
           'From FacVen F '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde And :Hasta) And '+
           '      (F.TipoFactura in (21,42,100)) <SUCUR> ';

   VtSuc = 'Select F.IdSucursal, Sum(F.Total) as Total, '+
           '       S.NombreSuc, Count(F.IdFactura) as CantOp '+
           'From FacVen F '+
           'Left Outer Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde And :Hasta) And '+
           '      (F.TipoFactura in (1,2,3,5,6,7,8,47,60,90)) <SUCUR> '+
           'Group By F.IdSucursal, S.NombreSuc '+
           'Order By 2 desc';

   CbSuc = 'Select F.IdSucursal, Sum(F.Total) as Total, '+
           '       S.NombreSuc, Count(F.IdFactura) as CantOp '+
           'From FacVen F '+
           'Left Outer Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde And :Hasta) and '+
           '      (F.TipoFactura in (21,42,100)) <SUCUR> '+
           'Group By F.IdSucursal, S.NombreSuc '+
           'Order By 2 desc';

   LqSuc = 'Select F.IdSucursal, Sum(F.Total) as Total, '+
           '       S.NombreSuc, Count(F.IdFactura) as CantOp '+
           'From FacVen F '+
           'Left Outer Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Where (F.State = 0) And '+
           '      (F.FechaF between :Desde And :Hasta) and '+
           '      (F.TipoFactura = 22) <SUCUR> '+
           'Group By F.IdSucursal, S.NombreSuc '+
           'Order By 2 desc';

  ItmDet = 'Select A.IdFactura, A.IdSucursal, A.IdPuntoVenta, A.DiaHora, '+
           '       A.IdArticulo, K.tarjeta FechaF, A.Cantidad, A.Descuento, '+
           '       A.PrcBonificacion, A.PrecioTotal, A.ValorLista, '+
           '       A.NroCtas, A.Oferta, A.Talle, A.SubDet, A.IdSubDep, '+
           '       A.DctoStk, A.Marca, A.Detalle, A.MaxDtoCdo, A.MaxDcto, '+
           '       A.IdAutorDto, A.MosDom, A.IdSucSalida, A.FechaSal, '+
           '       A.RemSucSal, A.RemFacSal, A.Nombre, A.IdArea, A.IdGrupo, '+
           '       A.IdSubGrupo, A.DetSuc,K.tarjeta '+
           'From PRODUCTOS_VENDIDOS_CAJA(:Desde, :Hasta, :IdSuc) A '+
           'Join FacVen F on F.IdFactura=A.IdFactura '+
            'Left outer Join Tarjetas K '+
           ' on K.IdTarjeta = F.IdTarjeta ';

  VtaDet = 'Select IdFactura, IdSucursal, IdPuntoVenta, IdArticulo, '+
           '       Oferta, Marca, Detalle, Color, Area, Grupo, '+
           '       SubGrupo, Cantidad, PrecioTotal, NroFactura, '+
           '       FechaF, DetSuc, Nombre, CodBusCli '+
           'From PRODUCTOS_VENDIDOS_DETALLADOS(:Desde, :Hasta) ';

  Items  = 'Select IdFactura, IdSucursal, IdPuntoVenta, IdArticulo, '+
           '       FechaF, Cantidad, Descuento, PRCBONIFICACION, '+
           '       PrecioTotal, ValorLista, NroCtas, Oferta, Talle, '+
           '       SubDet, IdSubDep, DctoStk, Marca, Detalle, DetSuc, '+
           '       MaxDtoCdo, MaxDcto '+
           'From PRODUCTOS_VENDIDOS_CAJA(:Desde, :Hasta, :IdSucur) '+
           'where (PrcBonificacion > MAXDTOCDO and NROCTAS = 0) or '+
           '      (PrcBonificacion > MAXDCTO and NROCTAS > 0) ';

   Areas = 'Select R.Area, S.DetSuc, G.Grupo, '+
           '       Sum(I.PrecioTotal) as Total '+
           'From FacVen F '+
           'Join ItemsFV I '+
           '  on (I.IdFactura = F.IdFactura) And '+
           '     (I.IdSucursal = F.IdSucursal) And '+
           '     (I.IdPuntoVenta = F.IdPuntoVenta) '+
           'Join Articulos A '+
           '  on A.IdArticulo = I.IdArticulo '+
           'Join Sucursales S '+
           '  on S.IdSucursal = F.IdSucursal '+
           'Join Areas R '+
           '  on R.IdArea = A.IdArea '+
           'Join Grupos G '+
           '  on (G.IdArea = A.IdArea) and '+
           '     (G.IdGrupo = A.IdGrupo) '+
           'Where (F.State = 0) and '+
           '      (F.TipoFactura in (1,2,3,5,6,7,8,47,60,90)) And '+
           '      (F.FechaF between :Desde And :Hasta) <SUCUR> '+
           'Group By R.Area, S.DetSuc, G.Grupo '+
           'Order By R.Area, S.DetSuc, G.Grupo ';

  SenSaF = 'Select IdFactura, IdSucursal, IdPuntoVenta, '+
           '       Cliente, NroFacturaS, FechaF, Total, '+
           '       Impresa, Nombre, TipoFacS, IdCompRef '+
           'From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc) '+
           'Where Impresa = 1 '+
           'Order By FechaF desc ';

  Tot_SS = 'Select Sum(TOTAL) as TotSS '+
           'From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc) '+
           'Where Impresa = 1 ';

  SenIng = 'Select IdFactura, IdSucursal, IdPuntoVenta, IdCompRef, FechaF, '+
           '       Cliente, Total, Nombre, TipoFacS, NroFacturaS, Impresa, '+
           '       TipoFacE, NroFacturaE, CobSenas, TotPag, OtrosPagos '+
           'From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc) '+
           'Where (IdCompRef > 0) And (Impresa > 1) ';

  Tot_SI = 'Select Sum(Total) as TotSenIng '+
           'From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc) '+
           'Where (IdCompRef > 0) And (Impresa > 1) ';


  OtrCmp = 'Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.Cliente, '+
           '       F.NroFactura, F.FechaF, F.Total, F.TipoFactura, '+
           '       C.Nombre, T.Descripcion as TipoFac, K.DetSuc '+
           'From FacVen F '+
           'Join Clientes C '+
           ' on C.IdCliente = F.Cliente And '+
           '    C.IdSucursal = F.IdSucursal '+
           'Join TiposComp T '+
           '  on T.IdComprobante = F.TipoFactura '+
           'Join Sucursales K '+
           '  on K.IdSucursal = F.IdSucursal '+
           'Where (F.TipoFactura in (15,20,40,43,44,45)) and '+
           '      (F.FechaF between :Desde and :Hasta) And '+
           '      (F.State = 0) <SUCUR> '+
           'Order By F.IdSucursal, F.NroFactura, F.FechaF desc ';

(*
/* Totales Guita
Select F.FechaF,
       Sum(F.Contado) as Efectivo,
       Sum(F.Tarjeta) as Tarjeta,
       Sum(F.Bonificacion) as Bonificacion,
       Sum(F.OtrosPagos) as Otros,
       Sum(F.Tickets) as Tickets,
       Sum(F.Cheque) as Cheques,
       Sum(F.CobSenas) as Senas,
       Sum(F.Contado+F.Tarjeta+F.Bonificacion+F.OtrosPagos+F.Tickets+F.Cheque+F.CobSenas) as Total,
       Sum(F.Total) As TFac
From FacVen F
Where (F.State = 0) And
      (F.FechaF between '02/01/2009' And '02/28/2009') And
      /*(F.TipoFactura in (1,2,3,5,6,7,8,,47,90)) Venta*/
      /*(F.TipoFactura in (21,42,100)) Cobros */
Group by F.FechaF
Order By F.FechaF

// SenSaF
Select IdFactura, IdSucursal, IdPuntoVenta,
       Cliente, NroFacturaS, FechaF, Total,
       Impresa, Nombre, TipoFacS, IdCompRef
From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc)
Where (IdCompRef = 0) And (Impresa = 0)
Order By FechaF desc

// SenIng
Select IdFactura, IdSucursal, IdPuntoVenta, FechaF,
       Cliente, Total, Nombre, TipoFacS, NroFacturaS,
       TipoFacE, NroFacturaE, CobSenas, TotPag, OtrosPagos
From FONDOS_SENASINGRESADAS(:Desde, :Hasta, :IdSuc)
Where (IdCompRef > 0) And (Impresa > 1)

/* Recibos */
Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.IdCompRef,
       F.TipoFactura, F.DiaHora, F.FechaF, F.NroFactura, F.Cliente,
       F.Total, F.NroCtas, F.Contado, F.Tarjeta, F.CtaCte, F.Cheque,
       F.Tickets, F.Bonificacion, F.OtrosPagos, F.CobSenas, F.Empleado,
       F.IdSubDep, S.DetSuc, C.Nombre as Entidad, E.Nombre as Vendedor,
       T.DescCorta as TipoFac, T.Descripcion as TipoFacLarga
From FacVen F
Left outer Join Clientes C
  on C.IdCliente = F.Cliente And C.IdSucursal = F.IdSucursal
Left outer Join Empleados E
  on E.IdEmpleado = F.Empleado
Left outer Join TiposComp T
  on T.IdComprobante = F.TipoFactura
Join Sucursales S
  on S.IdSucursal = F.IdSucursal
Where (F.State = 0) And
      (F.FechaF between :Desde and :Hasta) And
      (F.TipoFactura in (21,42,100)) And
      (F.IdSucursal = 2)
Order By F.IdSucursal, F.FechaF, F.NroFactura, F.DiaHora ;

/*  MoneyV */
Select Sum(F.Contado) as Efectivo, Sum(F.Tarjeta) as Tarjeta,
      Sum(F.Bonificacion) as Bonificacion, Sum(F.OtrosPagos) as Otros,
      Sum(F.Tickets) as Tickets, Sum(F.Cheque) as Cheques, Sum(F.CobSenas) as Senas
From FacVen F
Where (F.State = 0) And
     (F.FechaF between :Desde And :Hasta) And
     (F.TipoFactura in (1,2,3,5,6,7,8,43,44,45,47,90)) <SUCUR> ;

/*   MoneyC */
Select Sum(F.Contado) as Efectivo, Sum(F.Tarjeta) as Tarjeta,
       Sum(F.Bonificacion) as Bonificacion, Sum(F.OtrosPagos) as Otros,
       Sum(F.Tickets) as Tickets, Sum(F.Cheque) as Cheques, Sum(F.CobSenas) as Senas
From FacVen F
Where (F.State = 0) And
     (F.FechaF between :Desde And :Hasta) And
     (F.TipoFactura in (21,42,100)) <SUCUR> ;

/* VtSuc */
Select F.IdSucursal, Sum(F.Total) as Total,
       S.NombreSuc, Count(F.IdFactura) as CantOp
From FacVen F
Left Outer Join Sucursales S
 on S.IdSucursal = F.IdSucursal
Where (F.State = 0) And
     (F.FechaF between :Desde And :Hasta) And
     (F.TipoFactura in (1,2,3,5,6,7,8,47,90)) <SUCUR>
Group By F.IdSucursal, S.NombreSuc
Order By 2 desc;

 /* CbSuc */
Select F.IdSucursal, Sum(F.Total) as Total,
      S.NombreSuc, Count(F.IdFactura) as CantOp
From FacVen F
Left Outer Join Sucursales S
 on S.IdSucursal = F.IdSucursal
Where (F.State = 0) And
     (F.FechaF between :Desde And :Hasta) and
     (F.TipoFactura in (21,42,100)) <SUCUR>
Group By F.IdSucursal, S.NombreSuc
Order By 2 desc;

/* Calculo de ventas por vendedor

select IDEMPLEADO, sum(TOTALV), sum(CANTOP)
from PRODUCTOS_COMISIONES('10/01/2008', '10/31/2008', 3, 1)
group by IDEMPLEADO

Select Count /, Sum(Total)
From FacVen
Where Empleado = 11 And
      FechaF between '2008-10-01' And '2008-10-31'

Select F.Empleado, Sum(F.Total), E.Nombre,  Count(F.IdFactura)
From FacVen F
Left Outer Join Empleados E
  on E.Idempleado = F.Empleado
Where F.FechaF between '2008-10-01' And '2008-10-31' And
      F.TipoFactura in (1,2,3,5,6,7,8,90)
Group By F.Empleado, E.Nombre

/* Liquidaciones
Select F.IdFactura, F.IdSucursal, F.IdPuntoVenta, F.IdCompRef,
       F.TipoFactura, F.DiaHora, F.CantArtic, F.FechaF, F.NroFactura,
       F.Cliente, F.Total, F.NroCtas, F.Empleado, F.IdSubDep, S.DetSuc,
       C.Nombre as Entidad, K.Tarjeta, K.IdTarjeta, E.Nombre as Vendedor,
       T.DescCorta as TipoFac, T.Descripcion as TipoFacLarga
From FacVen F
Left outer Join Clientes C
  on C.IdCliente = F.Cliente And C.IdSucursal = F.IdSucursal
Left outer Join Empleados E
  on E.IdEmpleado = F.Empleado
Left outer Join TiposComp T
  on T.IdComprobante = F.TipoFactura
Join Sucursales S
  on S.IdSucursal = F.IdSucursal
Left outer Join Tarjetas K
  on K.IdTarjeta = F.IdCompRef
Where (F.State = 0) And
      (F.FechaF between :Desde and :Hasta) And
      (F.TipoFactura in (21,42,100)) <SUCUR>
Order By F.IdSucursal, F.FechaF, F.NroFactura, F.DiaHora

*)

procedure TfrmFondos.FormCreate(Sender: TObject);
begin
  edtCajaDesde.Date := Date;
  edtCajaHasta.Date := Date;
  gCaja.Enabled := False;
  gTotalesPtos.Enabled := False;
  gItems.Enabled := False;
  gTotalesVendedores.Enabled := False;
  gAreas.Enabled := False;

  cbSucursales.Items.Clear;
  cbSucursales.Items.AddObject('<TODAS>', TObject(0));
  with dmGestion do
  begin
    Sucursales.First;
    while not Sucursales.Eof do
    begin
      if (SucursalesACTIVA.AsInteger = Verdadero) And
         (SucursalesTACTIVIDAD.AsInteger = 0) then
      begin
        cbSucursales.Items.AddObject(SucursalesNombreSuc.AsString, TObject(SucursalesIdSucursal.AsInteger));
      end;
      Sucursales.Next;
    end;
  end;
  
  if (IsServer) And
     (IdBranch = 1) then
  begin
    cbSucursales.ItemIndex := cbSucursales.Items.IndexOf('<TODAS>');
    IdSucur := 0;
    IdSucES := 0;
    cbSucursales.Enabled := True;
  end
  else begin
    cbSucursales.ItemIndex := cbSucursales.Items.IndexOf(NameBranch);
    IdSucur := IdBranch;
    IdSucES := IdBranch;
    cbSucursales.Enabled := False;
  end;

  if dmSaveFile.trVerComp.InTransaction then
    dmSaveFile.trVerComp.Commit;
end;

procedure TfrmFondos.FormShow(Sender: TObject);
begin
  edtDesdeTS.Date := StartOfTheMonth(Date);
  edtHastaTS.Date := Date;
  gItems.GroupFieldName := 'DetSuc';
  gTotalesVendedores.Visible := True;
  TotalVS := 0;
  IdSucur := 0;
end;

procedure TfrmFondos.Calc_Caja;
begin
  TotalCaja := 0;

  if ResumenF.Active then
    ResumenF.EmptyDataSet
  else
    ResumenF.CreateDataSet;

  if TotPtos.Active then
    TotPtos.EmptyDataSet
  else
    TotPtos.CreateDataSet;

  try
    qSucur.Close;
    qSucur.SQL.Clear;
    qSucur.SQL.Text := SSucur;
    qSucur.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qSucur.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qSucur.Open;
    qSucur.First;
  except
    Screen.Cursor := crDefault;
    qSucur.Close;
    raise EUsuario.Create('Totales V: no se puede calcular el periodo.- ');
  end;

  while not qSucur.Eof do
  begin
    TotPtos.Append;
    TotPtosIdSucursal.AsInteger := qSucurIDSUCURSAL.AsInteger;
    TotPtosNombreSuc.AsString := qSucurNombreSuc.AsString;
    TotPtosTipoOP.AsInteger := 1; // Venta
    TotPtosTotal.AsCurrency := qSucurTOTAL.AsCurrency;
    TotPtosCantOP.AsInteger := qSucurCANTOP.AsInteger;
    TotPtos.Post;
    TotalCaja := TotalCaja + qSucurTotal.AsCurrency;
    qSucur.Next;
  end;

  gCaja.ColumnByName('NroFactura').FooterValue := 'Total:';
  gCaja.ColumnByName('Total').FooterValue := Format('%m',[TotalCaja]);

  try
    qSucur.Close;
    qSucur.SQL.Clear;
    qSucur.SQL.Text := SucCob;
    qSucur.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qSucur.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qSucur.Open;
    qSucur.First;
  except
    Screen.Cursor := crDefault;
    qSucur.Close;
    raise EUsuario.Create('Totales C: no se puede calcular el periodo.- ');
  end;

  while not qSucur.Eof do
  begin
    TotPtos.Append;
    TotPtosIdSucursal.AsInteger := qSucurIDSUCURSAL.AsInteger;
    TotPtosNombreSuc.AsString := qSucurNombreSuc.AsString;
    TotPtosTipoOP.AsInteger := 2; // Cobranza
    TotPtosTotal.AsCurrency := qSucurTOTAL.AsCurrency;
    TotPtosCantOP.AsInteger := qSucurCANTOP.AsInteger;
    TotPtos.Post;
    TotalCob := TotalCob + qSucurTotal.AsCurrency;
    qSucur.Next;
  end;

  try
    qSucur.Close;
    qSucur.SQL.Clear;
    qSucur.SQL.Text := SucLiq;
    qSucur.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qSucur.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qSucur.Open;
    qSucur.First;
  except
    Screen.Cursor := crDefault;
    qSucur.Close;
    raise EUsuario.Create('Totales L: no se puede calcular el periodo.- ');
  end;

  while not qSucur.Eof do
  begin
    TotPtos.Append;
    TotPtosIdSucursal.AsInteger := qSucurIDSUCURSAL.AsInteger;
    TotPtosNombreSuc.AsString := qSucurNombreSuc.AsString;
    TotPtosTipoOP.AsInteger := 3; // Liquidaciones
    TotPtosTotal.AsCurrency := qSucurTOTAL.AsCurrency;
    TotPtosCantOP.AsInteger := qSucurCANTOP.AsInteger;
    TotPtos.Post;
    TotalCob := TotalCob + qSucurTotal.AsCurrency;
    qSucur.Next;
  end;

  try
    qCobros.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qCobros.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qCobros.Open;
    qCobros.First;
    TotalCob := 0;
    while not qCobros.Eof do
    begin
      TotalCob := TotalCob + qCobrosTotal.AsCurrency;
      qCobros.Next
    end;
    gCobros.ColumnByName('NroFactura').FooterValue := 'Total:';
    gCobros.ColumnByName('Total').FooterValue := Format('%m',[TotalCob]);
  except
    on E:Exception do
    begin
      qCobros.Close;
      raise EUsuario.Create('Cobros: no se puede calcular el periodo.- '+E.Message);
    end;
  end;

  try
    qMoneyV.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qMoneyV.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qMoneyV.Open;
  except
    on E:Exception do
    begin
      qMoneyV.Close;
      raise EUsuario.Create('Monedas Ventas: no se puede calcular el periodo.- '+E.Message);
    end;
  end;

  try
    qMoneyC.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qMoneyC.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qMoneyC.Open;
  except
    on E:Exception do
    begin
      qMoneyC.Close;
      raise EUsuario.Create('Monedas Cobranzas: no se puede calcular el periodo.- '+E.Message);
    end;
  end;

  try
    qVendedores.Close;
    qVendedores.Sql.Clear;
    qVendedores.Sql.Add('Select IdEmpleado, Nombre, ');
    qVendedores.Sql.Add('       Sum(TotalV) as Total, ');
    qVendedores.Sql.Add('       Sum(TotalC) as TotalComision, ');
    qVendedores.Sql.Add('       Sum(CantOP) as CantOp ');
    qVendedores.Sql.Add('From PRODUCTOS_COMISIONES(:Desde, :Hasta, :IdSuc, 1) ');
    qVendedores.Sql.Add('Group By IdEmpleado, Nombre ');
    qVendedores.Sql.Add('Order By 3 desc ');
    qVendedores.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qVendedores.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qVendedores.ParamByName('IdSuc').AsInteger := IdSucur;
    qVendedores.Open;
  except
    on E: Exception do
    begin
      qVendedores.Close;
      raise EUsuario.Create('Vendedores: no se puede calcular el periodo.- ' + E.Message);
    end;
  end;
  qSucur.First;
  qVendedores.First;
  qMoneyV.First;
  qMoneyC.First;
  TotMoneyV := 0;
  TotMoneyC := 0;

  if TotalesMoneda.Active then
    TotalesMoneda.EmptyDataSet
  else
    TotalesMoneda.CreateDataSet;

  if TotMonedaV.Active then
    TotMonedaV.EmptyDataSet
  else
    TotMonedaV.CreateDataSet;

  if (not qMoneyV.IsEmpty) and
     (TotalCaja <> 0) then
  begin
    if qMoneyVEfectivo.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Efectivo';
      TotMonedaVImporte.AsCurrency := qMoneyVEfectivo.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency *100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVEfectivo.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Efectivo';
      TotalesMonedaImporte.AsCurrency := qMoneyVEfectivo.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVTarjeta.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Tarjetas';
      TotMonedaVImporte.AsCurrency := qMoneyVTarjeta.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVTARJETA.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Tarjetas';
      TotalesMonedaImporte.AsCurrency := qMoneyVTarjeta.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVTickets.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Tickets';
      TotMonedaVImporte.AsCurrency := qMoneyVTickets.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVTICKETS.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Tickets';
      TotalesMonedaImporte.AsCurrency := qMoneyVTICKETS.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVCheques.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Cheques';
      TotMonedaVImporte.AsCurrency := qMoneyVCheques.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVCHEQUES.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Cheques';
      TotalesMonedaImporte.AsCurrency := qMoneyVCHEQUES.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVBonificacion.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Bonificaciones';
      TotMonedaVImporte.AsCurrency := -qMoneyVBonificacion.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV - qMoneyVBONIFICACION.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Bonificaciones';
      TotalesMonedaImporte.AsCurrency := -qMoneyVBONIFICACION.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVOtros.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Otros';
      TotMonedaVImporte.AsCurrency := qMoneyVOtros.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVOTROS.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Otros';
      TotalesMonedaImporte.AsCurrency := qMoneyVOTROS.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;

    if qMoneyVSenas.AsCurrency <> 0 then
    begin
      TotMonedaV.Append;
      TotMonedaVDetalle.AsString := 'Seas';
      TotMonedaVImporte.AsCurrency := qMoneyVSenas.AsCurrency;
      TotMonedaVPrcMda.AsFloat := (TotMonedaVImporte.AsCurrency*100) / TotalCaja;
      TotMoneyV := TotMoneyV + qMoneyVSENAS.AsCurrency;
      TotMonedaV.Post;

      TotalesMoneda.Append;
      TotalesMonedaDetalle.AsString := 'Seas';
      TotalesMonedaImporte.AsCurrency := qMoneyVSENAS.AsCurrency;
      TotalesMonedaPrcMda.AsFloat := 0;
      TotalesMoneda.Post;
    end;
  end;

  if TotMonedaC.Active then
    TotMonedaC.EmptyDataSet
  else
    TotMonedaC.CreateDataSet;

  if (not qMoneyC.IsEmpty) and (TotalCob <> 0) then
  begin
    if qMoneyCEfectivo.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Efectivo';
      TotMonedaCImporte.AsCurrency := qMoneyCEfectivo.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCEfectivo.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Efectivo', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCEFECTIVO.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Efectivo';
        TotalesMonedaImporte.AsCurrency := qMoneyCEFECTIVO.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCTarjeta.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Tarjetas';
      TotMonedaCImporte.AsCurrency := qMoneyCTarjeta.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCTARJETA.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Tarjetas', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCTARJETA.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Tarjetas';
        TotalesMonedaImporte.AsCurrency := qMoneyCTARJETA.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCTickets.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Tickets';
      TotMonedaCImporte.AsCurrency := qMoneyCTickets.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCTICKETS.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Tickets', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCTICKETS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Tickets';
        TotalesMonedaImporte.AsCurrency := qMoneyCTICKETS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCCheques.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Cheques';
      TotMonedaCImporte.AsCurrency := qMoneyCCheques.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCCHEQUES.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Cheques', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCCHEQUES.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Cheques';
        TotalesMonedaImporte.AsCurrency := qMoneyCCHEQUES.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCBonificacion.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Bonificaciones';
      TotMonedaCImporte.AsCurrency := -qMoneyCBonificacion.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC - qMoneyCBONIFICACION.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Bonificaciones', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency - qMoneyCBONIFICACION.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Bonificaciones';
        TotalesMonedaImporte.AsCurrency := -qMoneyCBONIFICACION.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCOtros.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Otros';
      TotMonedaCImporte.AsCurrency := qMoneyCOtros.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCOTROS.AsCurrency;
      TotMonedaC.Post;
      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Otros', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCOTROS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Otros';
        TotalesMonedaImporte.AsCurrency := qMoneyCOTROS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;

    if qMoneyCSenas.AsCurrency <> 0 then
    begin
      TotMonedaC.Append;
      TotMonedaCDetalle.AsString := 'Seas';
      TotMonedaCImporte.AsCurrency := qMoneyCSenas.AsCurrency;
      TotMonedaCPrcMda.AsFloat := (TotMonedaCImporte.AsCurrency*100) / TotalCob;
      TotMoneyC := TotMoneyC + qMoneyCSENAS.AsCurrency;
      TotMonedaC.Post;

      if TotalesMoneda.Locate(TotalesMonedaDetalle.FieldName, 'Seas', []) then
      begin
        TotalesMoneda.Edit;
        TotalesMonedaImporte.AsCurrency := TotalesMonedaImporte.AsCurrency + qMoneyCSENAS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end
      else begin
        TotalesMoneda.Append;
        TotalesMonedaDetalle.AsString := 'Seas';
        TotalesMonedaImporte.AsCurrency := qMoneyCSENAS.AsCurrency;
        TotalesMonedaPrcMda.AsFloat := 0;
        TotalesMoneda.Post;
      end;
    end;
  end;

  TotalesMoneda.First;
  while (not TotalesMoneda.Eof) and
        ((TotMoneyC+TotMoneyV) <> 0) do
  begin
    TotalesMoneda.Edit;
    try
      TotalesMonedaPrcMda.AsFloat := (TotalesMonedaImporte.AsCurrency*100)/
                                     (TotMoneyC + TotMoneyV);
    except
      TotalesMonedaPrcMda.AsFloat := 0;
    end;
    TotalesMoneda.Post;
    TotalesMoneda.Next;
  end;

  TotPtos.IndexName := 'TotPtosTotal';
  gTotalesPtos.Enabled := True;
  gTotalesPtos.ColumnByName('NombreSuc').FooterValue := 'Total: ';
  gTotalesPtos.ColumnByName('Total').FooterValue := Format('%m',[TotalCaja+TotalCob]);
  gTotMonedasV.Enabled := True;
  gTotMonedasV.ColumnByName('Detalle').FooterValue := 'Total:';
  gTotMonedasV.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyV]);
  gTotMonedasC.Enabled := True;
  gTotMonedasC.ColumnByName('Detalle').FooterValue := 'Total:';
  gTotMonedasC.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyC]);
  gTotalesMonedas.Enabled := True;
  gTotalesMonedas.ColumnByName('Detalle').FooterValue := 'Total:';
  gTotalesMonedas.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyC+TotMoneyV]);
  gTotalesVendedores.Enabled := True;
end;

procedure TfrmFondos.Calc_Facturacion;
begin
  try
    qCaja.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qCaja.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qCaja.Open;
  except
    Screen.Cursor := crDefault;
    qCaja.Close;
    raise EUsuario.Create('CAJA: no se puede calcular el periodo.- ');
  end;

  try
    qSenas.ParamByName('Desde').AsDate := Ano_2000;
    qSenas.ParamByName('Hasta').AsDate := Ano_2025;
    qSenas.ParamByName('IdSuc').AsInteger := IdSucur;
    qSenas.Open;
  except
    Screen.Cursor := crDefault;
    qSenas.Close;
    raise EUsuario.Create('Seas: no se puede calcular el periodo.- ');
  end;

  try
    qTotSen.ParamByName('Desde').AsDate := Ano_2000;
    qTotSen.ParamByName('Hasta').AsDate := Ano_2025;
    qTotSen.ParamByName('IdSuc').AsInteger := IdSucur;
    qTotSen.Open;
    TotalSen := qTotSenTOTSS.AsCurrency;
  except
    Screen.Cursor := crDefault;
    qTotSen.Close;
    raise EUsuario.Create('Totales Seas: no se puede calcular el periodo.- ');
  end;

  try
    qSen_Ing.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qSen_Ing.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qSen_Ing.ParamByName('IdSuc').AsInteger := IdSucur;
    qSen_Ing.Open;
  except
    on E:Exception do
    begin
      Screen.Cursor := crDefault;
      qSen_Ing.Close;
      raise EUsuario.Create('Seas Ingresadas: no se puede calcular el periodo.- '+E.Message);
    end;
  end;

  try
    qTotSenIng.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qTotSenIng.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qTotSenIng.ParamByName('IdSuc').AsInteger := IdSucur;
    qTotSenIng.Open;
    TotSenIng := qTotSenIngTOTSENING.AsCurrency;
  except
    Screen.Cursor := crDefault;
    qTotSenIng.Close;
    raise EUsuario.Create('Total Seas Ingresadas: no se puede calcular el periodo.- ');
  end;

  try
    qMovTar.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qMovTar.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qMovTar.Open;
  except
    on E:Exception do
    begin
      Screen.Cursor := crDefault;
      qMovTar.Close;
      raise EUsuario.Create('TARJETAS: no se puede calcular el periodo.- '+E.Message);
    end;
  end;

  try
    qTotTj.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qTotTj.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qTotTj.Open;
  except
    on E: Exception do
    begin
      Screen.Cursor := crDefault;
      qTotTj.Close;
      raise EUsuario.Create('Totales TARJETAS: no se puede calcular el periodo.- ' + E.MEssage);
    end;
  end;

  qTotTj.First;
  TotalTarj := 0;
  if TotTar.Active then
    TotTar.EmptyDataSet
  else
    TotTar.CreateDataSet;
  while not qTotTj.Eof do
  begin
    TotTar.Append;
    TotTarTarjeta.AsString := qTotTjTarjeta.AsString;
    TotTarTotTar.AsCurrency := qTotTjTOTTAR.AsCurrency;
    TotTarCantOP.AsInteger := qTotTjCANTOP.AsInteger;
    TotTarDetSuc.AsString := Get_DetSuc(qTotTjIDSUCURSAL.AsInteger ,2);
    TotTarPrcTar.AsFloat := 0;
    TotalTarj := TotalTarj + qTotTjTOTTAR.AsCurrency;
    qTotTj.Next;
  end;

  TotTar.First;
  if TotalTarj <> 0 then
  begin
    while not TotTar.Eof do
    begin
      TotTar.Edit;
      TotTarPrcTar.AsFloat := (TotTarTotTar.AsCurrency * 100) / TotalTarj;
      TotTar.Post;
      TotTar.Next;
    end;
  end;
  gTotTarjetas.ColumnByName('TotTar').FooterValue := Format('%m',[TotalTarj]);
  gSenas.ColumnByName('Total').FooterValue := Format('%m',[TotalSen]);
  gSen_Ing.ColumnByName('Total').FooterValue := Format('%m',[TotSenIng]);
  TotTar.First;
  qMovTar.First;
  qCaja.First;
  gCaja.Enabled := True;
  gTotTarjetas.Enabled := True;
  gDetTarjetas.Enabled := True;
end;

procedure TfrmFondos.Calc_Productos;
begin
  try
    qItems.Close;
    qItems.SQL.Clear;
    qItems.SQL.Text := ItmDet+' Order By DetSuc';
    qItems.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qItems.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qItems.ParamByName('IdSuc').AsInteger := IdSucur;
    qItems.Open;
  except
    on E: Exception do
    begin
      raise EUsuario.Create('Items: no se puede calcular el periodo.- ' + E.Message);
    end;
  end;

  try
    qOtCmp.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qOtCmp.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qOtCmp.Open;
  except
    on E: Exception do
    begin
      raise EUsuario.Create('Otros comprobantes: no se puede calcular el periodo.- ' + E.Message);
    end;
  end;

  try
    cdsAreas.Close;
    cdsAreas.Params.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    cdsAreas.Params.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    cdsAreas.Open;
  except
    cdsAreas.Close;
    raise EUsuario.Create('Areas: no se puede calcular el periodo.- ');
  end;

  TotalArea := 0;
  cdsAreas.First;
  while not cdsAreas.Eof do
  begin
    TotalArea := TotalArea + cdsAreasTotal.AsCurrency;
    cdsAreas.Next;
  end;
  cdsAreas.First;
  while not cdsAreas.Eof do
  begin
    cdsAreas.Edit;
    if TotalArea <> 0 then
      cdsAreasPrcTot.AsFloat := (cdsAreasTotal.AsCurrency * 100) / TotalArea
    else
      cdsAreasPrcTot.AsFloat := 0;
    cdsAreas.Post;
    cdsAreas.Next;
  end;
  gAreas.ColumnByName('Total').FooterValue := Format('%m',[TotalArea]);
  gItems.ColumnByName('PrecioTotal').FooterValue := Format('%m',[TotalArea]);
  gAreas.GroupFieldName := 'AREA';
  cdsAreas.First;
  qItems.First;
  gItems.Enabled := True;
  gAreas.Enabled := True;
end;

procedure TfrmFondos.Calcular_Caja;
begin
  try
    qCaja.Close;
    qCobros.Close;
    qLiqTM.Close;
    qMovTar.Close;
    qTotTj.Close;
    qSucur.Close;
    qItems.Close;
    qAreas.Close;
    qOtCmp.Close;
    qMoneyV.Close;
    qMoneyC.Close;
    qVendedores.Close;
    qSenas.Close;
    qTotSen.Close;
    qSen_Ing.Close;
    qTotSenIng.Close;
    if dmSaveFile.trVerComp.InTransaction then
      dmSaveFile.trVerComp.Commit;
    if trCaja.InTransaction then
      trCaja.Commit;

    gCaja.Enabled := False;
    gTotalesPtos.Enabled := False;
    gItems.Enabled := False;
    gTotMonedasV.Enabled := False;
    gTotMonedasC.Enabled := False;
    gTotTarjetas.Enabled := False;
    gDetTarjetas.Enabled := False;
    gTotalesMonedas.Enabled := False;
    cdsAreas.Close;
    TotalCaja := 0;
    TotalTarj := 0;
    TotalSen := 0;
    TotSenIng := 0;
    try
      IdSucur := Integer(cbSucursales.Items.Objects[cbSucursales.ItemIndex]);
    except
      IdSucur := IdBranch;
    end;
    Screen.Cursor := crHourGlass;
    qCaja.SQL.Clear;
    qCobros.SQL.Clear;
    qLiqTM.SQL.Clear;
    qMovTar.SQL.Clear;
    qTotTj.SQL.Clear;
    qSucur.SQL.Clear;
    qOtCmp.SQL.Clear;
    qMoneyV.SQL.Clear;
    qMoneyC.SQL.Clear;
    qVendedores.SQL.Clear;
    qAreas.SQL.Clear;
    qSenas.SQL.Clear;
    qTotSen.SQL.Clear;
    qSen_Ing.SQL.Clear;
    qTotSenIng.SQL.Clear;

    if IdSucur > 0 then
    begin
      SVenta := StringReplace(Venta, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SCobro := StringReplace(Cobro, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SLiqTM := StringReplace(Cobro, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SMovTj := StringReplace(MovTj, '<SUCUR>', 'Where (IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      STotTj := StringReplace(TotTj, '<SUCUR>', 'Where (IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SSucur := StringReplace(VtSuc, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SucCob := StringReplace(CbSuc, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SucLiq := StringReplace(LqSuc, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SOtCmp := StringReplace(OtrCmp,'<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SMoneyV:= StringReplace(MoneyV,'<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SMoneyC:= StringReplace(MoneyC,'<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
      SAreas := StringReplace(Areas, '<SUCUR>', 'And (F.IdSucursal = '+IntToStr(IdSucur)+')', [rfReplaceAll]);
    end
    else begin
      SVenta := StringReplace(Venta, '<SUCUR>', '', [rfReplaceAll]);
      SCobro := StringReplace(Cobro, '<SUCUR>', '', [rfReplaceAll]);
      SLiqTM := StringReplace(Cobro, '<SUCUR>', '', [rfReplaceAll]);
      SMovTj := StringReplace(MovTj, '<SUCUR>', '', [rfReplaceAll]);
      STotTj := StringReplace(TotTj, '<SUCUR>', '', [rfReplaceAll]);
      SSucur := StringReplace(VtSuc, '<SUCUR>', '', [rfReplaceAll]);
      SucCob := StringReplace(CBSuc, '<SUCUR>', '', [rfReplaceAll]);
      SucLiq := StringReplace(LqSuc, '<SUCUR>', '', [rfReplaceAll]);
      SOtCmp := StringReplace(OtrCmp,'<SUCUR>', '', [rfReplaceAll]);
      SMoneyV:= StringReplace(MoneyV,'<SUCUR>', '', [rfReplaceAll]);
      SMoneyC:= StringReplace(MoneyC,'<SUCUR>', '', [rfReplaceAll]);
      SAreas := StringReplace(Areas, '<SUCUR>', '', [rfReplaceAll]);
    end;
    SEmple  := Emple;
    SSenSaF := SenSaF;
    STotSen := Tot_SS;
    SSenIng := SenIng;
    STotIng := Tot_SI;

    qCaja.SQL.Text := SVenta;
    qCobros.SQL.Text := SCobro;
    qLiqTM.SQL.Text := SLiqTM;
    qMovTar.SQL.Text := SMovTj;
    qTotTj.SQL.Text  := STotTj;
    qOtCmp.SQL.Text  := SOtCmp;
    qMoneyV.SQL.Text := SMoneyV;
    qMoneyC.SQL.Text := SMoneyC;
    qVendedores.SQL.Text := SEmple;
    qAreas.SQL.Text  := SAreas;
    qSenas.SQL.Text  := SSenSaF;
    qTotSen.SQL.Text := STotSen;
    qSen_Ing.SQL.Text := SSenIng;
    qTotSenIng.SQL.Text := STotIng;

    Calc_Caja;
    Calc_Facturacion;
    Calc_Productos;
    Calcular_VentaS;
  finally
    Screen.Cursor := crDefault;
  end;
end;

procedure TfrmFondos.CajaEnLpt;
begin
  try
    Screen.Cursor := crHourGlass;
    Calcular_Caja;
    Calc_Caja;
    Calc_Facturacion;
    Calc_Productos;
  finally
    Screen.Cursor := crDefault;
  end;
  rpCaja.DeviceType := 'Screen';
  rpCaja.Summary.Visible := True;
  lblTitulo.Caption := Format('%s - Movimientos de Caja Sucursal: %s entre %s al %s ',
                       [OwnerName, cbSucursales.Text, DateToStr(edtCajaDesde.Date), DateToStr(edtCajaHasta.Date)]);
  lblTitSen.Caption := Format('%s - Movimientos pendientes de realizacion Sucursal: %s al %s ',
                       [OwnerName, cbSucursales.Text, DateToStr(edtCajaHasta.Date)]);
  rpCaja.PrintReport;
end;

procedure TfrmFondos.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  Action := caFree;
end;

procedure TfrmFondos.btnSalirClick(Sender: TObject);
begin
  Close;
end;

procedure TfrmFondos.btnCalcularCajaClick(Sender: TObject);
begin
  if edtCajaDesde.Date <= edtCajaHasta.Date then
    Calcular_Caja
  else
    raise EUsuario.Create('Periodo mal ingresado.-');
end;

procedure TfrmFondos.gCajaDblClick(Sender: TObject);
begin
  Get_FacV(qCajaIdFactura.AsInteger,
           qCajaIdSucursal.AsInteger,
           qCajaIdPuntoVenta.AsInteger);
  if Hubo_ModComprobante then
    Calcular_Caja
  else
    gCaja.RefreshDisplay;
end;

procedure TfrmFondos.gCajaCalcCellColors(Sender: TObject; Field: TField;
           State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
begin
  Case qCajaTipoFactura.AsInteger of
    CreA, CreB: begin
      if Highlight then
        AFont.Color := clWhite
      else
        AFont.Color := clRed;
    end;
    DebA, DebB: begin
      if Highlight then
        AFont.Color := clWhite
      else
        AFont.Color := clGreen;
    end;
    CanceladoA, CanceladoB, CanceladoT: begin
      if Highlight then
        AFont.Color := clWhite
      else begin
        AFont.Color := clBlack;
        AFont.Style := AFont.Style + [fsStrikeOut];
      end;
    end;
  End;

  if qCajaIdSubDep.AsInteger > 0 then
  begin
    AFont.Color := clNavy;
    AFont.Style := AFont.Style + [fsItalic]
  end;
end;

procedure TfrmFondos.gItemsDblClick(Sender: TObject);
begin
  Get_FacV(qItemsIdFactura.AsInteger,
           qItemsIdSucursal.AsInteger,
           qItemsIdPuntoVenta.AsInteger);
end;

procedure TfrmFondos.gItemsTitleButtonClick(Sender: TObject; AFieldName: string);
begin
  try
    qItems.Close;
    qItems.SQL.Clear;
    qItems.SQL.Text := ItmDet+' Order By '+AFieldName;
    qItems.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qItems.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qItems.ParamByName('IdSuc').AsInteger := IdSucur;
    qItems.Open;
    qItems.First;
  except
    on E: Exception do
    begin
      raise EUsuario.Create('Items: no se puede calcular el periodo.- ' + E.Message);
    end;
  end;
end;

procedure TfrmFondos.gItemsUpdateFooter(Sender: TObject);
begin
  gItems.ColumnByName('PrecioTotal').FooterValue := Format('%m',[TotalArea]);
end;

procedure TfrmFondos.gTotMonedasVUpdateFooter(Sender: TObject);
begin
  gTotMonedasV.ColumnByName('Detalle').FooterValue := 'Total:';
  gTotMonedasV.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyV]);
end;

procedure TfrmFondos.gTotTarjetasUpdateFooter(Sender: TObject);
begin
  gTotTarjetas.ColumnByName('TotTar').FooterValue := Format('%m',[TotalTarj]);
end;

procedure TfrmFondos.gTotMonedasCUpdateFooter(Sender: TObject);
begin
  gTotMonedasC.ColumnByName('Detalle').FooterValue := 'Total:';
  gTotMonedasC.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyC]);
end;

procedure TfrmFondos.gDetTarjetasDblClick(Sender: TObject);
begin
  Get_ModT(qMovTarIdFactura.AsInteger,
           qMovTarIdSucursal.AsInteger,
           qMovTarIDTARJETA.AsInteger,
           qMovTarIdMov.AsInteger);
  if Hubo_ModComprobante then
    Calcular_Caja
  else
    gDetTarjetas.RefreshDisplay;
end;

procedure TfrmFondos.lblOferGetText(Sender: TObject; var Text: String);
begin
  if qItemsOferta.AsInteger > 0 then
    Text := 'S'
  else
    Text := 'N';
end;

procedure TfrmFondos.lblPVOfertaGetText(Sender: TObject; var Text: string);
begin
  if qArtVendOferta.AsInteger > 0 then
    Text := 'Si'
  else
    Text := 'No';
end;

procedure TfrmFondos.qArtVendOFERTAGetText(Sender: TField; var Text: string; DisplayText: Boolean);
begin
  if qArtVendOferta.AsInteger > 0 then
    Text := 'Si'
  else
    Text := 'No';
end;

procedure TfrmFondos.qItemsOfertaGetText(Sender: TField; var Text: String; DisplayText: Boolean);
begin
  if qItemsOferta.AsInteger > 0 then
    Text := 'S'
  else
    Text := 'N';
end;

procedure TfrmFondos.opSucursalesClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qSucur;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opProductosClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qItems;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opCobranzaClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qCobros;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opComprobantesClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qCaja;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.OperacionesporVendedorCajaClick(Sender: TObject);
begin
  if not qVendedores.IsEmpty then
  begin
    rpVendedores.DeviceType := 'Screen';
    lblTitVtaVdor1.Caption := OwnerName;
    lblTitVtaVdor2.Caption := Format('Totales Vendedores entre %s al %s ',
                                     [DateToStr(edtCajaDesde.Date), DateToStr(edtCajaHasta.Date)]);
    rpVendedores.Print;
  end;
end;

procedure TfrmFondos.opVendedoresClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qVendedores;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opTarjetasClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qMovTar;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opTotalesVClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := TotMonedaV;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opTotalesCClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := TotMonedaC;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.opGruposClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := cdsAreas;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.OtrosComprobantesClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qOtCmp;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.ProductosVendidosCajaClick(Sender: TObject);
begin
  try
    Screen.Cursor := crSQLWait;
    qArtVend.Close;
    qArtVend.ParamByName('Desde').AsDate := edtCajaDesde.Date;
    qArtVend.ParamByName('Hasta').AsDate := edtCajaHasta.Date;
    qArtVend.ParamByName('IdSuc').AsInteger := IdSucur;
    qArtVend.ParamByName('IdSuc').AsInteger := IdSucur;
    qArtVend.Open;
  finally
    Screen.Cursor := crDefault;
  end;
  if not qArtVend.IsEmpty then
  begin
    lblPVTitulo1.Caption := OwnerName;
    lblPVTitulo2.Caption := Format('Productos vendidos de Sucursal: %s entre %s al %s ',
                                   [cbSucursales.Text, DateToStr(edtCajaDesde.Date),
                                    DateToStr(edtCajaHasta.Date)]);
    rpInfPrdVta.Print;
  end;
end;

procedure TfrmFondos.gSen_IngUpdateFooter(Sender: TObject);
begin
  gSen_Ing.ColumnByName('Total').FooterValue := Format('%m',[TotSenIng]);
end;

procedure TfrmFondos.gAreasUpdateFooter(Sender: TObject);
begin
  gAreas.ColumnByName('Total').FooterValue := Format('%m',[TotalArea]);
end;

procedure TfrmFondos.qMovTarCalcFields(DataSet: TDataSet);
begin
  qMovTarDetOper.AsString := Format('%s N %s %m A %s ',
                            [qMovTarTarjeta.AsString,
                             qMovTarCodTar.AsString,
                             qMovTarImpCuota.AsCurrency,
                             qMovTarAutorizacion.AsString]);
end;

procedure TfrmFondos.SenasOcupadasClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qSen_Ing;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.SenasSaFenStockClick(Sender: TObject);
begin
  dmGestion.IyC_Exp.DataSet := qSenas;
  dmGestion.IyC_Exp.Select;
end;

procedure TfrmFondos.ArmarTabla;
var
  i: Integer;
  //p: TPrintField;
begin
  gVentaS.Selected.Clear;
  (*
  qpgSucur.Fields.Clear;
  qpgSucur.Title.Text := 'Totales Ventas Sucursales periodo: '+edtDesdeTS.Text+' al '+edtHastaTS.Text;
  *)
  i := VentaS.FieldCount;
  While i > 0 do
  begin
    VentaS.FieldDefs.Delete(i-1);
    Dec(i);
  end;

  VentaS.Active := False;
  VentaS.FieldDefs.Add('Fecha', ftDate);
  VentaS.FieldDefs.Add('TxDia', ftCurrency);

  qTVentas.First;
  while not qTVentas.Eof do
  begin
    try
      VentaS.Fields.CheckFieldName('Suc' + qTVentasIdSucursal.AsString);
      VentaS.FieldDefs.Add('Suc' + qTVentasIdSucursal.AsString, ftCurrency);
    except

    end;
    qTVentas.Next;
  end;

  // Titulos Columnas

  if VentaS.Active then
    VentaS.EmptyDataSet
  else
    VentaS.CreateDataSet;

  gVentaS.Selected.Add('Fecha'+#9+'13'+#9+'Fecha'+#9+'F');
  TDateField(VentaS.FieldByName('Fecha')).DisplayFormat := 'ddd dd/mm/yy';
  VentaS.FieldByName('Fecha').DisplayWidth := 12;
  (*
  p := qpgSucur.Fields.Add;
  p.DataField := 'Fecha';
  p.Title := 'Fecha';
  p.Alignment := taCenter;
  p.TitleAlignment := taCenter;
  p.Width := gVentaS.Canvas.TextWidth('X')*30;
  *)
  gVentaS.Selected.Add('TxDia'+#9+'13'+#9+'Tot Diarios'+#9+'F');
  TMDOBCDField(VentaS.FieldByName('TxDia')).DisplayFormat := '0.00;(0.00)';
  VentaS.FieldByName('TxDia').DisplayWidth := 13;
  (*
  p := qpgSucur.Fields.Add;
  p.DataField := 'TxDia';
  p.Title := 'Tot Diarios';
  p.TitleAlignment := taCenter;
  p.FormatFloat := '0.00;(0.00)';
  p.SubTotalType := ttAutoSum;
  p.Alignment := taRightJustify;
  p.Width := gVentaS.Canvas.TextWidth('X')*50;
  *)
  qTVentas.First;
  while not qTVentas.Eof do
  begin
    if Trim(qTVentaSSucursal.AsString) > Vacio then
    begin
      VentaS.FieldByName('Suc' + qTVentaSIdSucursal.AsString).DisplayLabel := qTVentaSSucursal.AsString;
      VentaS.FieldByName('Suc' + qTVentaSIdSucursal.AsString).DisplayWidth := 12;
      TMDOBCDField(VentaS.FieldByName('Suc' + qTVentaSIdSucursal.AsString)).DisplayFormat := '0.00;(0.00)';
      VentaS.FieldByName('Suc' + qTVentaSIdSucursal.AsString).Alignment := taRightJustify;
      gVentaS.Selected.Add('Suc'+ qTVentaSIdSucursal.AsString+#9+'11'+#9+qTVentaSSucursal.AsString+#9+'F');
       (*
        p := qpgSucur.Fields.Add;
        p.DataField := 'Suc' + qTVentaSIdSucursal.AsString;
        p.Title := qTVentaSSucursal.AsString;
        p.TitleAlignment := taLeftJustify;
        p.FormatFloat := '0.00;(0.00)';
        p.Alignment := taRightJustify;
        p.SubTotalType := ttAutoSum;
        p.Width := gVentaS.Canvas.TextWidth('X')*50;
        *)
    end;
    qTVentaS.Next;
  end;
  gVentaS.FixedCols := 0;
end;

procedure TfrmFondos.LlenarTabla;
var
  i: SmallInt;
begin
  try
    VentaS.DisableControls;
    VentaS.First;
    while not qVentaS.Eof do
    begin
      if qVentaSIdSucursal.AsInteger > 0 then
      begin
        if VentaS.Locate(Ventas.FieldByName('Fecha').FieldName, qVentaSFechaF.AsDateTime, []) then
        begin
          VentaS.Edit;
          VentaS.FieldByName('Suc'+qVentaSIdSucursal.AsString).AsCurrency := VentaS.FieldByName('Suc'+qVentaSIdSucursal.AsString).AsCurrency + qVentaSTotal.AsCurrency;
          VentaS.Post;
        end
        else begin
          VentaS.Append;
          VentaS.FieldByName('Fecha').AsDateTime := qVentaSFechaF.AsDateTime;
          VentaS.FieldByName('Suc'+qVentaSIdSucursal.AsString).AsCurrency := qVentaSTotal.AsCurrency;
          VentaS.Post;
        end;
      end;
      qVentas.Next;
    end;

    VentaS.First;
    while not VentaS.Eof do
    begin
      try
        TotXDia := 0;
        for i:= 1 to Max_Suc do
        begin
          try
            TotXDia := TotXDia + VentaS.FieldByName('Suc'+IntToStr(i)).AsCurrency;
          except
            TotXDia := TotXDia;
          end;
        end;
        Ventas.Edit;
        VentaS.FieldByName('TxDia').AsCurrency := TotXDia;
        VentaS.Post;
      finally
        VentaS.Next;
      end;
    end;
  finally
    VentaS.IndexFieldNames := VentaS.FieldByName('Fecha').FieldName;
    VentaS.Last;
    VentaS.EnableControls;
  end;
end;

procedure TfrmFondos.TodoelInformeClick(Sender: TObject);
begin
  CajaEnLpt;
end;

procedure TfrmFondos.TotalesCajaClick(Sender: TObject);
begin
  try
    rpCaja.DeviceType := 'Screen';
    rpcaja.Summary.Visible := False;
    lblTitulo.Caption := Format('%s - Movimientos de Caja Sucursal: %s entre %s al %s ',
                         [OwnerName, cbSucursales.Text, DateToStr(edtCajaDesde.Date), DateToStr(edtCajaHasta.Date)]);
    rpCaja.PrintReport;
  finally
    rpcaja.Summary.Visible := True;
  end;
end;

procedure TfrmFondos.TotalesTabla;
begin
  TotalVS := 0;
  if qTVentaS.Active then
  begin
    qTVentas.First;
    gVentas.ColumnByName('Fecha').FooterValue := 'Totales en $';
    while not qTVentas.Eof do
    begin
      gVentas.ColumnByName('Suc'+ qTVentaSIdSucursal.AsString).FooterValue := Format('%11.2f',[qTVentaSTTotal.AsCurrency]);
      TotalVS := TotalVS + qTVentaSTTotal.AsCurrency;
      qTVentaS.Next;
    end;
  end;
  gVentas.ColumnByName('TxDia').FooterValue := Format('%11.2f',[TotalVS]);
  Application.ProcessMessages;
end;

procedure TfrmFondos.Calcular_VentaS;
begin
  TotalVS := 0;
  gVentaS.Visible := False;
  if edtDesdeTS.Date <= edtHastaTS.Date then
  begin
    try
      Screen.Cursor := crHourGlass;
      qVentaS.Close;
      qVentaS.ParamByName('Desde').AsDate := edtDesdeTS.Date;
      qVentaS.ParamByName('Hasta').AsDate := edtHastaTS.Date;
      qVentaS.Prepare;
      qVentaS.Open;
      if not qVentaS.IsEmpty then
      begin
        qTVentaS.Close;
        qTVentaS.ParamByName('Desde').AsDate := edtDesdeTS.Date;
        qTVentaS.ParamByName('Hasta').AsDate := edtHastaTS.Date;
        qTVentaS.Prepare;
        qTVentaS.Open;
        ArmarTabla;
        LlenarTabla;
        TotalesTabla;
        if not VentaS.IsEmpty then
          gVentaS.Visible := True;
      end;
    finally
      Screen.Cursor := crDefault;
    end;
  end;
end;

procedure TfrmFondos.btnImprimirTSClick(Sender: TObject);
begin
  (*
  if pdSucur.Execute then
    qpgSucur.Print;
  if not VentaS.IsEmpty then
  begin
    lblDSuc2.Caption := 'M & B';
    lblDSuc3.Caption := 'D2000';
    lblDSuc4.Caption := 'Rawson';
    lblDSuc5.Caption := 'Jachal';
    lblDSuc6.Caption := 'M.Agua';
    lblDSuc7.Caption := 'Barreal';
    lblDSuc9.Caption := 'R.Libano';
    lblDSuc10.Caption := 'Rivadavia';
    lblDia.DisplayFormat := 'ddd dd/mm/yy';
    lblDia.DataField := VentaS.Fields[0].FieldName;
    lblTxDia.DataField := VentaS.Fields[1].FieldName;
    lblSuc3.DataField := VentaS.Fields[2].FieldName;
    lblSuc4.DataField := VentaS.Fields[3].FieldName;
    lblSuc5.DataField := VentaS.Fields[4].FieldName;
    lblSuc6.DataField := VentaS.Fields[5].FieldName;
    lblSuc7.DataField := VentaS.Fields[6].FieldName;
    lblSuc9.DataField := VentaS.Fields[7].FieldName;
    lblSuc10.DataField := VentaS.Fields[8].FieldName;
    lblTotDia.DataField := VentaS.Fields[1].FieldName;
    lblTotDia.DisplayFormat := '$ 0.00';
    lblTSuc3.DataField := VentaS.Fields[2].FieldName;
    lblTSuc3.DisplayFormat := '$ 0.00';
    lblTSuc4.DataField := VentaS.Fields[3].FieldName;
    lblTSuc4.DisplayFormat := '$ 0.00';
    lblTSuc5.DataField := VentaS.Fields[4].FieldName;
    lblTSuc5.DisplayFormat := '$ 0.00';
    lblTSuc6.DataField := VentaS.Fields[5].FieldName;
    lblTSuc6.DisplayFormat := '$ 0.00';
    lblTSuc7.DataField := VentaS.Fields[6].FieldName;
    lblTSuc7.DisplayFormat := '$ 0.00';
    lblTSuc9.DataField := VentaS.Fields[7].FieldName;
    lblTSuc9.DisplayFormat := '$ 0.00';
    lblTSuc10.DataField := VentaS.Fields[8].FieldName;
    lblTSuc10.DisplayFormat := '$ 0.00';
    lblTituloTS.Caption := 'Totales Ventas Sucursales periodo: '+edtDesde.Text+' al '+edtHasta.Text;
    rpVentasS.Print;
  end;
  *)
end;

procedure TfrmFondos.btnExportarTSClick(Sender: TObject);
begin
  if VentaS.Active then
  begin
    with dmGestion do
    begin
      IyC_Exp.DataSet := VentaS;
      IyC_Exp.Select;
    end;
  end;
end;

procedure TfrmFondos.btnCalcularTSClick(Sender: TObject);
begin
  Calcular_VentaS;
end;

procedure TfrmFondos.gVentaSUpdateFooter(Sender: TObject);
begin
  TotalesTabla;
end;

procedure TfrmFondos.btnRendicionClick(Sender: TObject);
begin
  frmRendicion := TfrmRendicion.Create(Self);
  frmRendicion.ShowModal;
end;

procedure TfrmFondos.btnSucursalesClick(Sender: TObject);
begin
  frmGestSucursales := TfrmGestSucursales.Create(Self);
  frmGestSucursales.Show
end;

procedure TfrmFondos.gItemsCalcCellColors(Sender: TObject; Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
begin
  if not Highlight then
  begin
    if qItemsIdSubDep.AsInteger > 0 then
    begin
      AFont.Color := clNavy;
      AFont.Style := AFont.Style + [fsBold]
    end;

    if qItemsDCTOSTK.AsInteger = Falso then
    begin
      AFont.Color := clGreen;
      AFont.Style := AFont.Style + [fsItalic]
    end;

    if (qItemsPRCBONIFICACION.AsFloat > qItemsMAXDCTO.AsFloat) And
       (qItemsNroCtas.AsInteger > 0) then
    begin
      AFont.Color := clRed;
      AFont.Style := AFont.Style + [fsUnderline, fsBold]
    end;

    if (qItemsPRCBONIFICACION.AsFloat > qItemsMAXDTOCDO.AsFloat) And
       (qItemsNroCtas.AsInteger = 0) then
    begin
      AFont.Color := clPurple;
      AFont.Style := AFont.Style + [fsUnderline, fsBold]
    end;

    if qItemsOferta.AsInteger = Verdadero then
    begin
      AFont.Color := $007000DF;
      AFont.Style := AFont.Style + [fsBold]
    end;

    if (Up_Case(Field.Name) = Up_Case('qItemsIDARTICULO')) or
       (Up_Case(Field.Name) = Up_Case('qItemsMARCA')) or
       (Up_Case(Field.Name) = Up_Case('qItemsPRCBONIFICACION')) or
       (Up_Case(Field.Name) = Up_Case('qItemsDESCUENTO')) then
    begin
      AFont.Style := AFont.Style + [fsBold];
      AFont.Size := 7;
    end
    else begin
      AFont.Style := AFont.Style - [fsBold];
      AFont.Size := 9;
    end;
  end;
end;

procedure TfrmFondos.gCobrosUpdateFooter(Sender: TObject);
begin
  gCobros.ColumnByName('NroFactura').FooterValue := 'Total:';
  gCobros.ColumnByName('Total').FooterValue := Format('%m',[TotalCob]);
end;

procedure TfrmFondos.gCajaUpdateFooter(Sender: TObject);
begin
  gCaja.ColumnByName('NroFactura').FooterValue := 'Total:';
  gCaja.ColumnByName('Total').FooterValue := Format('%m',[TotalCaja]);
end;

procedure TfrmFondos.gCobrosCalcCellColors(Sender: TObject; Field: TField;
    State: TGridDrawState; Highlight: Boolean; AFont: TFont; ABrush: TBrush);
begin
  Case qCobrosTipoFactura.AsInteger of
   ReciboX: begin
     if Highlight then
       AFont.Color := clWhite
     else
       AFont.Color := $00A40052;
   end;
   Cobro_Sena: begin
     if Highlight then
       AFont.Color := clWhite
     else
       AFont.Color := clRed;
   end;
   SaldoAFavor: begin
     if Highlight then
       AFont.Color := clWhite
     else
       AFont.Color := clBlue;
   end;
   Liquidacion: begin
     if Highlight then
       AFont.Color := clWhite
     else
       AFont.Color := clBlack;
   end;
  end;
end;

procedure TfrmFondos.gTotalesPtosUpdateFooter(Sender: TObject);
begin
  gTotalesPtos.ColumnByName('NombreSuc').FooterValue := 'Total: ';
  gTotalesPtos.ColumnByName('Total').FooterValue := Format('%m',[TotalCaja+TotalCob]);
end;

procedure TfrmFondos.TotPtosTipoOPGetText(Sender: TField; var Text: String; DisplayText: Boolean);
begin
  Case TotPtosTipoOP.AsInteger of
    1: Text := 'VTA';
    2: Text := 'COB';
    3: Text := 'LIQ';
  end;
end;

procedure TfrmFondos.lblTipoOPGetText(Sender: TObject; var Text: String);
begin
  Case TotPtosTipoOP.AsInteger of
    1: Text := 'VTA';
    2: Text := 'COB';
    3: Text := 'LIQ';
  end;
end;

procedure TfrmFondos.gCobrosDblClick(Sender: TObject);
begin
  Get_FacV(qCobrosIDFACTURA.AsInteger,
           qCobrosIDSUCURSAL.AsInteger,
           qCobrosIDPUNTOVENTA.AsInteger);
  if Hubo_ModComprobante then
    Calcular_Caja
  else
    gCobros.RefreshDisplay;
end;

procedure TfrmFondos.gSenasUpdateFooter(Sender: TObject);
begin
  gSenas.ColumnByName('Total').FooterValue := Format('%m',[TotalSen]);
end;

procedure TfrmFondos.gSenasDblClick(Sender: TObject);
begin
  Get_FacV(qSenasIDFACTURA.AsInteger,
           qSenasIDSUCURSAL.AsInteger,
           qSenasIDPUNTOVENTA.AsInteger);
  if Hubo_ModComprobante then
    Calcular_Caja
  else
    gSenas.RefreshDisplay;
end;

procedure TfrmFondos.gTotalesMonedasUpdateFooter(Sender: TObject);
begin
  gTotalesMonedas.ColumnByName('Detalle').FooterValue := 'Total: ';
  gTotalesMonedas.ColumnByName('Importe').FooterValue := Format('%m',[TotMoneyC+TotMoneyV]);
end;

procedure TfrmFondos.gOtrosCompDblClick(Sender: TObject);
begin
  Get_FacV(qOtCmpIDFACTURA.AsInteger,
           qOtCmpIDSUCURSAL.AsInteger,
           qOtCmpIDPUNTOVENTA.AsInteger);
  if Hubo_ModComprobante then
    Calcular_Caja
  else
    gOtrosComp.RefreshDisplay;
end;

end.
